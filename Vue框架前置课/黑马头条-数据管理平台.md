# 一、项目介绍



黑马头条-数据管理平台：对IT资讯移动网站的数据，进行<font color='red'>数据管理</font>

数据管理平台-演示：配套代码在本地运行

移动网站-演示： http://geek.itheima.net/

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521095041638.png" alt="image-20250521095041638" style="zoom:50%;" />

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521095049414.png" alt="image-20250521095049414" style="zoom:50%;" />



**功能：**

1. 登录和权限判断
2. 查看文章内容列表（筛选，分页）
3. 编辑文章（数据回显）
4. 删除文章
5. 发布文章（图片上传，富文本编辑器）

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521095120671.png" alt="image-20250521095120671" style="zoom:50%;" />

> 数据管理平台，未登录能否管理数据？
> ✓ 不能，数据是公司内部的，需账号登录后管理



# 二、项目准备



**技术：**

- 基于 Bootstrap 搭建网站标签和样式
- 集成<font color='red'> wangEditor 插件</font>实现富文本编辑器
- 使用原生 JS 完成<font color='red'>增删改查</font>等业务
- 基于 axios 与黑马头条线上接口交互
- 使用<font color='red'> axios 拦截器</font>进行权限判断



**项目准备：**

准备配套的素材代码

包含：html，css，js，静态图片，第三方插件等等



**目录管理：**

建议这样管理，方便查找和扩展

- assets：资源文件夹（图片，字体等）
- lib：资料文件夹（第三方插件，例如：form-serialize）
- <font color='red'>page</font>：页面文件夹
- <font color='red'>utils</font>：实用程序文件夹（工具插件）

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521095322552.png" alt="image-20250521095322552" style="zoom:50%;" />



# 三、验证码登录



<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521095514345.png" alt="image-20250521095514345" style="zoom:50%;" />

**目标：**完成验证码登录，后端设置验证码默认为 246810

**原因：**因为短信接口不是免费的，防止攻击者恶意盗刷

**步骤：**

1. 在 utils/request.js 配置 axios 请求<font color='red'>基地址</font>

  > 作用：提取公共前缀地址，配置后 axios 请求时都会 baseURL + url
  >
  > <img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521095451342.png" alt="image-20250521095451342" style="zoom:50%;" />
2. 收集手机号和验证码数据
3. 基于 axios 调用验证码登录接口
4. 使用 Bootstrap 的 Alert 警告框反馈结果给用户

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521095459907.png" alt="image-20250521095459907" style="zoom:50%;" />



## 1. 验证码登录-流程



手机号+验证码，登录流程：

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521095559093.png" alt="image-20250521095559093" style="zoom:50%;" />



## 2. token 的介绍



**概念：**访问权限的<font color='red'>令牌</font>，本质上是一串<font color='red'>字符串</font>

**创建：**正确登录后，由后端签发并返回

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521095628815.png" alt="image-20250521095628815" style="zoom:50%;" />

**作用：**判断是否有<font color='red'>登录状态</font>等，控制访问权限

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521095642693.png" alt="image-20250521095642693" style="zoom:50%;" />



> [!CAUTION]
>
> token 的注意：
>
> - <font color='red'>前端</font>只能判断 token 的<font color='red'>有无</font>
> - <font color='red'>后端</font>通过解密可以提取 token 字符串的原始信息，判断<font color='red'>有效性</font>



## 3. token 的使用



**目标：**只有登录状态，才可以访问内容页面

**步骤：**

1. 在 utils/auth.js 中判断无 token 令牌字符串，则强制跳转到登录页（手动修改地址栏测试）
2. 在登录成功后，保存 token 令牌字符串到本地，再跳转到首页（手动修改地址栏测试）

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521095754150.png" alt="image-20250521095754150" style="zoom:50%;" />



# 四、个人信息设置和 axios 请求拦截器



**需求：**设置用户昵称

**语法：**axios 可以在 headers 选项传递请求头参数

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521100115639.png" alt="image-20250521100115639" style="zoom:50%;" />

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521100123438.png" alt="image-20250521100123438" style="zoom:50%;" />

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521100131204.png" alt="image-20250521100131204" style="zoom:50%;" />

**问题：**很多接口，都需要携带 token 令牌字符串

**解决：**在请求拦截器（[拦截器 | Axios中文文档 | Axios中文网](https://www.axios-http.cn/docs/interceptors)）统一设置公共 headers 选项



**axios 请求拦截器：**发起请求之前，触发的配置函数，对<font color='red'>请求参数</font>进行额外配置

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521100323518.png" alt="image-20250521100323518" style="zoom:50%;" />

axios 请求拦截器，什么时候使用？

✓ 有<font color='red'>公共配置</font>和设置时，统一设置在请求拦截器中



# 五、axios 响应拦截器和身份验证失败



**axios 响应拦截器：**响应回到 then/catch 之前，触发的<font color='red'>拦截函数</font>，对<font color='red'>响应结果统一处理</font>

axios 响应拦截器，什么时候触发成功/失败的回调函数？

- 状态为 <font color='red'>2xx </font>触发成功回调，<font color='red'>其他</font>则触发<font color='red'>失败</font>的回调函数

例如：身份验证失败，统一判断并做处理

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521100500982.png" alt="image-20250521100500982" style="zoom:50%;" />

```js
error?.response?status === 401
//其中？为可选链运算符，如果使用此运算符访问的对象或调用的函数是 undefined 或 null，则表达式会短路并计算为 undefined，而不是抛出错误
```

[可选链运算符（?.） - JavaScript | MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Optional_chaining)



# 六、优化-axios 响应结果



**目标：**axios 直接接收服务器返回的响应结果



<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521100611719.png" alt="image-20250521100611719" style="zoom:50%;" />



# 七、发布文章



## 1. 富文本编辑器



**富文本：**带样式，多格式的文本，在前端一般使用标签配合内联样式实现

**富文本编辑器：**用于编写富文本内容的容器

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521100657569.png" alt="image-20250521100657569" style="zoom:50%;" />



**目标：**发布文章页，富文本编辑器的集成

**使用：**wangEditor 插件

**步骤：**参考文档（[快速开始 | wangEditor](https://www.wangeditor.com/v5/getting-started.html)）

1. 引入 CSS 定义样式
2. 定义 HTML 结构
3. 引入 JS 创建编辑器
4. 监听内容改变，保存在隐藏文本域（便于后期收集）



## 2. 频道列表



**目标：**展示频道列表，供用户选择

**步骤：**

1. <font color='red'>获取</font>频道列表数据
2. <font color='red'>展示</font>到下拉菜单中

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521100857160.png" alt="image-20250521100857160" style="zoom:50%;" />



## 3. 封面设置



**目标：**文章封面的设置

**步骤：**

1. 准备标签<font color='red'>结构和样式</font>
2. <font color='red'>选择文件</font>并保存在 FormData
3. 单独<font color='red'>上传</font>图片并得到<font color='red'>图片 URL 地址</font>
4. <font color='red'>回显</font>并<font color='red'>切换</font> img 标签展示（隐藏 + 号上传标签）

注意：图片地址临时存储在 img 标签上，并未和文章关联保存

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521100951155.png" alt="image-20250521100951155" style="zoom:50%;" />



## 4. 收集并保存



**目标：**收集文章内容，并提交保存

**步骤：**

1. 基于 form-serialize 插件<font color='red'>收集</font>表单数据对象
2. 基于 axios 提交到服务器<font color='red'>保存</font>
3. 调用 Alert 警告框<font color='red'>反馈</font>结果给用户
4. <font color='red'>重置表单</font>并跳转到列表页

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521101055829.png" alt="image-20250521101055829" style="zoom:50%;" />

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521101108856.png" alt="image-20250521101108856" style="zoom:50%;" />



# 八、内容管理



## 1. 文章列表展示



**目标：**获取文章列表并展示

**步骤：**

1. 准备查询参数对象
2. 获取文章列表数据
3. 展示到指定的标签结构中

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521154056157.png" alt="image-20250521154056157" style="zoom:50%;" />

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521154107051.png" alt="image-20250521154107051" style="zoom:50%;" />



## 2. 筛选功能



**目标：**根据筛选条件，获取匹配数据展示

**步骤：**

1. 设置频道列表数据
2. 监听筛选条件改变，保存查询信息到<font color='red'>查询参数对象</font>
3. 点击筛选时，传递<font color='red'>查询参数对象</font>到服务器
4. 获取匹配数据，覆盖到页面展示

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521154248122.png" alt="image-20250521154248122" style="zoom:50%;" />



## 3. 分页功能



**目标：**完成文章列表，分页管理功能

**步骤：**

1. 保存并设置文章<font color='red'>总条数</font>
2. 点击下一页，做<font color='red'>临界值判断</font>，并<font color='red'>切换页码参数</font>请求最新数据
3. 点击上一页，做临界值判断，并切换页码参数<font color='red'>请求最新数据</font>

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521154331695.png" alt="image-20250521154331695" style="zoom:50%;" />

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521154338773.png" alt="image-20250521154338773" style="zoom:50%;" />



## 4. 删除功能



**目标：**完成删除文章功能

**步骤：**

1. 关联<font color='red'>文章 id</font> 到删除图标
2. 点击删除时，获取文章 id
3. 调用<font color='red'>删除接口</font>，传递文章 id 到服务器
4. <font color='red'>重新获取</font>文章列表，并覆盖展示

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521154419046.png" alt="image-20250521154419046" style="zoom:50%;" />



## 5. 删除最后一条



**目标：**在删除<font color='red'>最后一页</font>，<font color='red'>最后一条</font>时有 Bug

**解决：**

1. 删除成功时，判断 <font color='red'>DOM 元素只剩一条</font>，让当前页码 <font color='red'>page--</font>
2. 注意，当前页码为 1 时不能继续向前翻页
3. 重新设置页码数，获取最新列表展示

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521154504909.png" alt="image-20250521154504909" style="zoom:50%;" />



## 6. 编辑文章-回显



**目标：**编辑文章时，回显数据到表单

**步骤：**

1. 页面<font color='red'>跳转传参</font>（URL 查询参数方式）
2. 发布文章页面<font color='red'>接收参数判断</font>（共用同一套表单）
3. 修改标题和按钮文字
4. 获取文章详情数据并回显表单

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521154547650.png" alt="image-20250521154547650" style="zoom:50%;" />

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521154606226.png" alt="image-20250521154606226" style="zoom:50%;" />

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521154613086.png" alt="image-20250521154613086" style="zoom:50%;" />



## 7. 编辑文章-保存



**目标：**确认修改，保存文章到服务器

**步骤：**

1. <font color='red'>判断</font>按钮文字，区分业务（因为共用一套表单）
2. 调用编辑文章接口，保存信息到服务器
3. 基于 Alert 反馈结果消息给用户

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521154645861.png" alt="image-20250521154645861" style="zoom:50%;" />

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521154652956.png" alt="image-20250521154652956" style="zoom:50%;" />



# 九、退出登录



**目标：**完成退出登录效果

**步骤：**

1. 绑定点击事件
2. 清空本地缓存，跳转到登录页面

<img src="../../../AppData/Roaming/Typora/typora-user-images/image-20250521154725165.png" alt="image-20250521154725165" style="zoom:50%;" />