# 第一章 计算机网络体系结构



## 一、 计算机网络的概念



### 知识总览

<img src="../images/image-20241122155610070.png" alt="image-20241122155610070" style="zoom:50%;" />

### 1.什么是计算机网络？



计算机网络（Computer networking）是一个将众多<font color='red'>分散的、自治的</font>计算机系统，通过<font color='orange'>通信设备</font>与<font color='green'>线路</font>连接起来，由功能完善的<font color='blue'>软件</font>实现<font color='red'>资源共享</font>和<font color='red'>信息传递</font>的系统。

<img src="../images/image-20241122155830880.png" alt="image-20241122155830880" style="zoom:33%;" />



### 2.计算机网络、互连网、互联网的区别



> 计算机网络（computer networking）
> 互连网（internet）
> 互联网（或因特网，Internet）



#### 一个简单的计算机网络



计算机网络（简称 网络）：由若干<font color='red'>结点（node）</font>和连接这些结点的<font color='red'>链路（link）</font>组成



> 结点可以是计算机、集线器、交换机、路由器等
>
> <font color='red'>集线器（Hub）</font>：
> • 可以<font color='red'>把多个结点连接起来，组成一个计算机网络</font>
> • 普通民用领域已很少用集线器
> • “集线器”工作在物理层，将在第二章学习
>
> <font color='red'>交换机（Switch）</font>：
> • 可以<font color='red'>把多个结点连接起来，组成一个计算机网络</font>
> • 家庭、公司、学校通常用交换机组建内部网络
> • “交换机”工作在数据链路层，将在第三章学习

> 链路可以是有线链路、无线链路

<img src="../images/image-20241122160215080.png" alt="image-20241122160215080" style="zoom: 33%;" /><img src="../images/image-20241122160251050.png" alt="image-20241122160251050" style="zoom: 33%;" /><img src="../images/image-20241122160306506.png" alt="image-20241122160306506" style="zoom: 33%;" />



#### 互连网（internet）



> <font color='red'>路由器（router）</font>：
> • 可以<font color='red'>把两个或多个计算机网络互相连接起来</font>，形成规模更大的计算机网络，也可称为“互连网”
> • 路由器工作在网络层，将在第四章学习

<img src="../images/image-20241122160518511.png" alt="image-20241122160518511" style="zoom:33%;" />



**例子：某银行的内部网络（互连网）**

<img src="../images/image-20241122160627460.png" alt="image-20241122160627460" style="zoom:33%;" />

**例子：家庭内部网络**

<img src="../images/image-20241122160827527.png" alt="image-20241122160827527" style="zoom:33%;" />

Tips：计算机网络课程中的“路由器”和“家用路由器”有一些区别。==家用路由器 = 路由器 + 交换机 + 其他功能==



#### 互联网（或因特网， Internet ）



> 注：你家的路由器通常不会直连运营商路由器，中间会经过更复杂的链路连接。此图是为了简化理解

<img src="../images/image-20241122161100323.png" alt="image-20241122161100323" style="zoom:33%;" />



<font color='red'>ISP</font>： **Internet Service Provider**，即互联网服务提供商，如 中国电信/移动/联通

==互联网（ 或因特网，Internet ）==：由各大ISP和国际机构组建的，覆盖全球范围的<font color='red'>互连网（internet）</font>

> Internet的前身是ARPAnet。

==互联网==必须使用<font color='red'>TCP/IP协议</font>通信，<font color='red'>互连网</font>可使用<font color='red'>任意协议</font>通信

> TCP/IP协议是Internet的核心。



#### 如何理解“TCP/IP协议”？

<img src="../images/image-20241122161231647.png" alt="image-20241122161231647" style="zoom:33%;" />



## 二、 计算机网络的组成、功能



### 知识总览



<img src="../images/image-20241122161506487.png" alt="image-20241122161506487" style="zoom:50%;" />



### 1.计算机网络的组成：从组成部分看



<img src="../images/image-20241122161551587.png" alt="image-20241122161551587" style="zoom:50%;" />



#### 硬件、软件、协议



<img src="../images/image-20241122161639535.png" alt="image-20241122161639535" style="zoom: 33%;" />



#### 拓展：网络适配器

>  其中一个重要功能是实现串行/并行转换，还要实现以太网协议



<img src="../images/image-20241122161736435.png" alt="image-20241122161736435" style="zoom:33%;" />



### 2.计算机网络的组成：从工作方式看



<img src="../images/image-20241122161820589.png" alt="image-20241122161820589" style="zoom:50%;" />



#### 计算机网络的组成



<img src="../images/image-20241122161843187.png" alt="image-20241122161843187" style="zoom:33%;" />



### 3.计算机网络的组成：从逻辑功能看



<img src="../images/image-20241122161919898.png" alt="image-20241122161919898" style="zoom: 50%;" />



#### 资源子网、通信子网



<img src="../images/image-20241122161955666.png" alt="image-20241122161955666" style="zoom:33%;" />



### 4.计算机网络的功能



<img src="../images/image-20241122162026866.png" alt="image-20241122162026866" style="zoom:50%;" />



#### 数据通信



> 最基本、最重要的功能

<img src="../images/image-20241122162128010.png" alt="image-20241122162128010" style="zoom: 33%;" />



#### 资源共享



<img src="../images/image-20241122162206662.png" alt="image-20241122162206662" style="zoom:33%;" />



#### 分布式处理



<img src="../images/image-20241122162228986.png" alt="image-20241122162228986" style="zoom:33%;" />



#### 提高可靠性



<img src="../images/image-20241122162352602.png" alt="image-20241122162352602" style="zoom:33%;" />



#### 负载均衡



<img src="../images/image-20241122162421825.png" alt="image-20241122162421825" style="zoom:33%;" />



### 总结

<img src="../images/image-20241122162501287.png" alt="image-20241122162501287" style="zoom:50%;" />



## 三、 电路交换 报文交换 分组交换

> 数据交换三大形式

### 知识总览



<img src="../images/image-20241122162626791.png" alt="image-20241122162626791" style="zoom:50%;" />



### 引入



#### 1.Intro：人类历史上的通信网络

<img src="../images/image-20241122162704470.png" alt="image-20241122162704470" style="zoom:33%;" />

#### 2.Intro：计算机网络发展初期面临的问题



<img src="../images/image-20241122162724920.png" alt="image-20241122162724920" style="zoom:33%;" />

#### 3.电话网络（采用“电路交换”技术）

<img src="../images/image-20241122162759027.png" alt="image-20241122162759027" style="zoom:33%;" />

<img src="../images/image-20241122162810216.png" alt="image-20241122162810216" style="zoom:33%;" />

#### 4.早期的电话交换机



电路<font color='red'>交换</font>（Circuit <font color='red'>Switching</font>）：通过物理线路的连接，<font color='red'>动态地分配传输线路资源</font>

<img src="../images/image-20241122163215277.png" alt="image-20241122163215277" style="zoom:33%;" />



### 1.电话网络（采用“电路交换”技术）



电路交换的过程：

①建立连接（尝试占用通信资源）
②==通信（一直占用通信资源）==
③释放连接（归还通信资源）

<img src="../images/image-20241122163317026.png" alt="image-20241122163317026" style="zoom:33%;" />



#### 如果计算机网络采用“电路交换”技术？



<img src="../images/image-20241122163343150.png" alt="image-20241122163343150" style="zoom:33%;" />



#### “电路交换”的优缺点



电路交换的<font color='orange'>优点</font>：

通信前从主叫端到被叫端建立一条<font color='red'>专用的物理通路</font>，在通信的全部时间内，两个用户<font color='red'>始终占用</font>端到端的<font color='red'>线路资源</font>。数据直送，<font color='red'>传输速率高</font>（`电路交换更适用于：低频次、大量地传输数据`）



电路交换的<font color='orange'>缺点</font>：

- <font color='red'>建立/释放连接</font>，需要<font color='red'>额外的时间开销</font>。（`计算机之间数据往往是“突发式”传输，即往往会高频次、少量地传输数据。`）
- <font color='red'>线路</font>被通信双方<font color='red'>独占</font>，<font color='red'>利用率低</font>。
- <font color='red'>线路</font>分配的<font color='red'>灵活性差</font>。
- 交换节点<font color='red'>不支持“差错控制”</font>（无法发现传输过程中的发生的数据错误）



### 2.电报网络（采用“报文交换”技术）



> 存储转发的思想：把传送的数据单元先<font color='red'>存储</font>进中间节点，再根据目的地址<font color='red'>转发</font>至下一节点。

<img src="../images/image-20241122163819241.png" alt="image-20241122163819241" style="zoom:33%;" />

<img src="../images/image-20241122163911563.png" alt="image-20241122163911563" style="zoom:33%;" />



#### 如果计算机网络采用“报文交换”技术？



<img src="../images/image-20241122163942128.png" alt="image-20241122163942128" style="zoom:33%;" />



#### “报文交换”的优缺点



报文交换的<font color='orange'>优点</font>：

- 通信前<font color='red'>**无需**建立连接</font>
- 数据以“<font color='red'>报文</font>”为单位被交换节点间“<font color='red'>存储转发</font>”，通信<font color='red'>线路可以灵活分配</font>
- 在通信时间内，两个用户<font color='red'>无需独占</font>一整条物理线路。相比于电路交换，<font color='red'>线路利用率高</font>
- 交换节点<font color='red'>支持“差错控制”</font>（通过校验技术）



报文交换的<font color='orange'>缺点</font>：

- <font color='red'>报文不定长，不方便存储转发管理</font>
- <font color='red'>长报文的存储转发时间开销大、缓存开销大</font>
- <font color='red'>长报文容易出错，重传代价高</font>



### 3.“分组交换”技术



<img src="../images/image-20241122164245168.png" alt="image-20241122164245168" style="zoom:33%;" />



#### 现代计算机网络采用“分组交换”技术



<img src="../images/image-20241122164320275.png" alt="image-20241122164320275" style="zoom:33%;" />



<img src="../images/image-20241122164342661.png" alt="image-20241122164342661" style="zoom:33%;" />

<img src="../images/image-20241122164356608.png" alt="image-20241122164356608" style="zoom:33%;" />

<img src="../images/image-20241122164409976.png" alt="image-20241122164409976" style="zoom:33%;" />

#### “分组交换”的优缺点



分组交换的<font color='orange'>优点</font>：

- 通信前<font color='red'>**无需**建立连接</font>

- 数据以“==分组==”为单位被交换节点间“<font color='red'>存储转发</font>”，通信<font color='red'>线路可以灵活分配</font>

- 通信时间内，两个用户<font color='red'>无需独占</font>一整条物理线路。相比于电路交换，<font color='red'>线路利用率高</font>

- 交换节点<font color='red'>支持“差错控制”</font>（通过校验技术）

	

<font color='orange'>相比于报文交换</font>，分组交换改进了如下问题：

- <font color='red'>分组定长，方便存储转发管理</font>

- <font color='red'>分组的存储转发时间开销小、缓存开销小</font>

- <font color='red'>分组不易出错，重传代价低</font>

	

分组交换的<font color='orange'>缺点</font>：

- <font color='red'>相比于报文交换，控制信息占比增加</font>
- <font color='red'>相比于电路交换，依然存在存储转发时延</font>
- <font color='red'>报文被拆分为多个分组，传输过程中可能出现失序、丢失等问题，增加处理的复杂度</font>



#### “虚电路交换”技术



> 基于分组交换

虚电路交换的过程（将在第四章学习）：

①建立连接（虚拟电路）
②通信（分组按序、按已建立好的既定线路发送，通信双方不独占线路）
③释放连接

<img src="../images/image-20241122202313645.png" alt="image-20241122202313645" style="zoom:33%;" />

<img src="../images/image-20241122202326516.png" alt="image-20241122202326516" style="zoom:33%;" />

<img src="../images/image-20241122202338373.png" alt="image-20241122202338373" style="zoom:33%;" />



### 4.性能分析



#### 电路交换性能分析

<img src="../images/image-20241122202555339.png" alt="image-20241122202555339" style="zoom:33%;" />

#### 报文交换性能分析

<img src="../images/image-20241122202618831.png" alt="image-20241122202618831" style="zoom:33%;" />

#### 分组交换性能分析

<img src="../images/image-20241122202635903.png" alt="image-20241122202635903" style="zoom:33%;" />

#### 三种交换方式的性能对比

<img src="../images/image-20241122202700293.png" alt="image-20241122202700293" style="zoom:33%;" />



## 四、计算机网络的分类



### 知识总览

<img src="../images/image-20241122203245833.png" alt="image-20241122203245833" style="zoom:50%;" />



### 1.按分布范围分类

<img src="../images/image-20241122203321745.png" alt="image-20241122203321745" style="zoom: 50%;" />

注：如今的局域网几乎都是采用“以太网技术”实现，因此“<font color='red'>以太网</font>”几乎成了“<font color='red'>局域网</font>”的代名词。



#### 举例：广域网（WAN）、局域网（LAN）



<img src="../images/image-20241122203414626.png" alt="image-20241122203414626" style="zoom:33%;" />

#### 例子：个域网（PAN）

<img src="../images/image-20241122203433729.png" alt="image-20241122203433729" style="zoom:33%;" />



### 2.按传输技术分类



**==广播式网络==**——当一台计算机发送数据分组时，广播范围内所有计算机都会收到该分组，并通过检查分组的目的地址决定是否接收该分组

Eg：所有无线网络都是“广播式”

> @某人的群消息



**==点对点网络==**——数据只会从发送方“点对点”发到接收方，精准送达

Eg：路由器转发的数据分组

> 一对一私信



### 3.按拓扑结构分类



<img src="../images/image-20241122204049576.png" alt="image-20241122204049576" style="zoom:33%;" />

**<font color='red'>总线形结构</font>**：数据“<font color='red'>广播式</font>”传输；存在“<font color='red'>总线争用</font>”问题

典型代表：集线器连接的设备

<img src="../images/image-20241122204519618.png" alt="image-20241122204519618" style="zoom:33%;" />

<font color='red'>**环形结构**</font>：数据“<font color='red'>广播式</font>”传输；通过<font color='red'>“令牌”解决总线争用问题</font>，令牌顺环形依次传递，拿到令牌者可使用总线

典型代表：令牌环网（流行于2000年以前的局域网技术）

<img src="../images/image-20241122205200975.png" alt="image-20241122205200975" style="zoom:33%;" />

<font color='red'>**星形结构**</font>：由中央设备实现数据的“<font color='red'>点对点</font>”传输；<font color='red'>不存在“总线争用”问题</font>

典型代表：以太网交换机连接的设备

<img src="../images/image-20241122205231693.png" alt="image-20241122205231693" style="zoom:33%;" />

<font color='red'>**网状结构**</font>：数据通过各中间节点逐一存储转发；属于“<font color='red'>点到点</font>”传输

典型代表：由众多路由器构建的广域网



### 小故事：局域网技术的发展



<img src="../images/image-20241122205314087.png" alt="image-20241122205314087" style="zoom:33%;" />



### 4.按使用者分类



==公用网==——向公众开放的网络。如：办宽带、交手机话费即可使用的互联网

==专用网==——仅供某个组织内部使用的网络。如：政府、军队、电力、银行的内部网络



### 5.按传输介质分类



==有线网络==——如：网线、光纤

==无线网络==——如： 5G 、WiFi、卫星



## 五、计算机网络的性能指标



### 知识总览

> 最重要的两个性能指标：带宽和时延

<img src="../images/image-20241122215029587.png" alt="image-20241122215029587" style="zoom:50%;" />

<img src="../images/image-20241122212630636.png" alt="image-20241122212630636" style="zoom:50%;" />



### 1.性能指标：速率



<img src="../images/image-20241122212712522.png" alt="image-20241122212712522" style="zoom:33%;" /><img src="../images/image-20241122212725014.png" alt="image-20241122212725014" style="zoom: 50%;" />



<font color='red'>信道（Channel）</font>：表示向某一方向传送<font color='red'>信息的通道</font>（信道≠通信线路)一条通信线路在逻辑上往往对应一条<font color='red'>发送信道</font>和一条<font color='red'>接收信道</font>



<img src="../images/image-20241122212806261.png" alt="image-20241122212806261" style="zoom: 33%;" />

<font color='red'>速率（Speed）</font>：指连接到网络上的节点在信道上传输数据的速率。也称<font color='red'>数据率</font>或<font color='red'>比特率</font>、<font color='red'>**数据传输速率**</font>

<font color='red'>速率单位</font>： bit/s ，或 b/s，或 <font color='red'>**bps**</font>

⚠注意：有时也会用 ==B/s==（==1B = 8b==，B=Byte 字节，b=bit 比特）

<img src="../images/image-20241122212917870.png" alt="image-20241122212917870" style="zoom:50%;" />

### 2.性能指标：带宽



<img src="../images/image-20241122212949235.png" alt="image-20241122212949235" style="zoom: 33%;" /><img src="../images/image-20241122213003474.png" alt="image-20241122213003474" style="zoom: 50%;" />

<font color='red'>带宽（bandwidth）</font>：某信道所能传送的<font color='red'>最高数据率</font>



#### 例题1：速率、带宽

<img src="../images/image-20241122213045704.png" alt="image-20241122213045704" style="zoom:50%;" />

<font color='red'>结论：节点间通信实际能达到的最高速率，由带宽、节点性能共同限制</font>



#### 性能指标2：带宽（另一种含义）



<img src="../images/image-20241122213131243.png" alt="image-20241122213131243" style="zoom:50%;" />



#### 不严谨的类比：人眼的“带宽”



<img src="../images/image-20241122213206627.png" alt="image-20241122213206627" style="zoom:50%;" />



### 3.性能指标：吞吐量



吞吐量（Throughput）：指<font color='red'>单位时间</font>内通过某个网络（或信道、接口）的<font color='red'>实际数据量</font>。

吞吐量受带宽限制、受复杂的网络负载情况影响

<img src="../images/image-20241122213254246.png" alt="image-20241122213254246" style="zoom: 50%;" />



### 4.性能指标：时延



<font color='red'>时延（Delay）</font>：指数据（一个报文或分组，甚至比特）从网络（或链路）的<font color='red'>一端传送到另一端所需的时间</font>。有时也称为<font color='red'>延迟</font>或<font color='red'>迟延</font>。

<img src="../images/image-20241122213348581.png" alt="image-20241122213348581" style="zoom:50%;" />

<img src="../images/image-20241122213401259.png" alt="image-20241122213401259" style="zoom:50%;" />

<img src="../images/image-20241122213421274.png" alt="image-20241122213421274" style="zoom:50%;" />



#### 例题2：时延



<img src="../images/image-20241122213527386.png" alt="image-20241122213527386" style="zoom:50%;" />

#### 例题3：时延



<img src="../images/image-20241122213554714.png" alt="image-20241122213554714" style="zoom:50%;" />



### 5.性能指标：时延带宽积



<img src="../images/image-20241122213658026.png" alt="image-20241122213658026" style="zoom:50%;" />

**<font color='red'>时延带宽积</font> = <font color='orange'>传播时延 </font>× <font color='green'>带宽</font>**

<font color='red'>**时延带宽积的含义**</font>：一条链路中，<font color='red'>已</font>从发送端<font color='red'>发出但尚未到达</font>接收端的<font color='red'>**最大**比特数</font>

> 注：时延带宽积用于设计最短帧长（将在后续章节学习）



#### 例题4：2023年408真题

<img src="../images/image-20241122213837721.png" alt="image-20241122213837721" style="zoom:50%;" /><img src="../images/image-20241122213913401.png" alt="image-20241122213913401" style="zoom:33%;" /><img src="../images/image-20241122213924531.png" alt="image-20241122213924531" style="zoom:33%;" />

传输文件总时间 = 0.01ms+0.08ms+0.01ms+ (0.08ms × 1000) = <font color='red'>80.10ms</font>



### 6.性能指标：往返时延



<font color='red'>**往返时延 RTT（ Round-Trip Time ）**</font>：表示从发送方<font color='orange'>发送完数据</font>，到发送方<font color='green'>收到来自接收方的确认</font>总共经历的时间。

<img src="../images/image-20241122214645959.png" alt="image-20241122214645959" style="zoom:33%;" />

> 注：为简化问题，此图并未分析发送方和接收方之间的其他节点

<img src="../images/image-20241122214706526.png" alt="image-20241122214706526" style="zoom: 50%;" />



### 性能指标7：信道利用率



**<font color='red'>信道利用率</font>：某个信道有百分之多少的时间是有数据通过的。**

<img src="../images/image-20241122214900366.png" alt="image-20241122214900366" style="zoom:50%;" />



<font color='red'>信道利用率不能太低，浪费资源</font>(`有些高速路段车很少，车道利用率极低——>浪费资源`)

<font color='red'>信道利用率也不能太高，容易导致网络拥塞</font>(`节假日高速路，车道利用率极高——>堵车`)



#### 例题5：信道利用率



<img src="../images/image-20241122214957277.png" alt="image-20241122214957277" style="zoom:50%;" />



## 六、 计算机网络分层结构



### 知识总览

<img src="../images/image-20241122215205954.png" alt="image-20241122215205954" style="zoom:50%;" />



### 1.“分层”的设计思想



<img src="../images/image-20241122215229615.png" alt="image-20241122215229615" style="zoom: 33%;" />

==<font color='red'>分层</font>==的设计思想：将庞大而复杂的问题，转化为若干较小的局部问题。

快递网络是一个非常复杂的系统。<font color='red'>快递网络需要完成很多功能</font>：

- 货物打包
- 取件、派件
- 冷链存储
- 包裹“路由”
- 运输包裹
- ......



#### 快递网络的四层体系结构



<img src="../images/image-20241122215414211.png" alt="image-20241122215414211" style="zoom:33%;" />

- 将复杂的快递网络在逻辑上划分为多个层次，并将各种“功能”安排在合适的层次中
- <font color='red'>不同类型的节点，实现的功能层次可能不一样</font>



#### 计算机网络要完成的功能



<img src="../images/image-20241122215455864.png" alt="image-20241122215455864" style="zoom: 33%;" />

计算机网络是一个非常复杂的系统，要完成诸多功能，如：

- <font color='red'>差错控制</font>：确保数据在传输过程中不出错。
- <font color='red'>流量控制</font>：发送端的发送速率必须使接收端来得及接收，不要太快。
- <font color='red'>分段和重装</font>：发送端将要发送的数据块划分为更小的单位，并在接收端将其还原。
- <font color='red'>复用和分用</font>：发送端几个高层会话复用一条低层的连接，在接收端再进行分用。
- <font color='red'>连接建立和释放</font>：交换数据前先建立一条逻辑连接，数据传送结束后释放连接。



#### 计算机网络的分层结构



<img src="../images/image-20241122220509087.png" alt="image-20241122220509087" style="zoom: 33%;" />



- **将复杂的计算机网络在逻辑上划分为多个层次，并将各种“功能”安排在合适的层次中**
- <font color='red'>**不同类型的节点，实现的功能层次可能不一样**</font>



#### 快递网络的五层体系结构



<img src="../images/image-20241122220607623.png" alt="image-20241122220607623" style="zoom: 33%;" />

- **<font color='red'>分层结构的设计并不唯一</font>，可以根据实际需求增加或减少层次**
- **<font color='red'>同一个功能</font>可以在多个层次中重复出现**



### 2.三种常见的计算机网络体系结构



<img src="../images/image-20241122220707892.png" alt="image-20241122220707892" style="zoom: 33%;" />



#### 网络体系结构的概念



<font color='red'>网络的体系结构</font> (Network Architecture) 是计算机网络的各层及其协议的<font color='red'>集合</font>，就是这个计算机网络及其构件所应完成的<font color='red'>功能的精确定义（不涉及实现）</font>。

<font color='red'>实现 </font>(implementation) 是遵循这种体系结构的前提下，用何种硬件或软件完成这些功能的问题。

==体系结构是<font color='red'>抽象</font>的，而实现则是<font color='red'>具体</font>的==



### 3.各层之间的关系



<img src="../images/image-20241122220901147.png" alt="image-20241122220901147" style="zoom: 33%;" />

<img src="../images/image-20241129213515812.png" alt="image-20241129213515812" style="zoom: 33%;" />

- **<font color='red'>实体</font>**：在计算机网络的分层结构中，第 n 层中的活动元素（软件+硬件）通常称为第 n 层实体。不同机器上的同一层称为<font color='red'>*对等层*</font>，同

	一层的实体称为*<font color='red'>对等实体</font>*。

- **<font color='red'>协议</font>**：即 网络协议（Network Protocol），是控制对等实体之间进行通信的规则的集合，<u><font color='red'>是水平的</font></u>。

- **<font color='red'>接口</font>**：即同一节点内*<font color='red'>相邻两层的实体</font>*交换信息的逻辑接口，又称为**<font color='red'>服务访问点</font>**（Service Access Point， SAP）。
- **<font color='red'>服务</font>**：服务是指*<font color='red'>下层为紧邻的上层</font>*提供的功能调用，它<u><font color='red'>是垂直的</font></u>。



### 4.数据的传输过程



#### 水平视角



<img src="../images/image-20241129213759037.png" alt="image-20241129213759037" style="zoom:33%;" />

YSCS协议：

<img src="../images/image-20241129213833719.png" alt="image-20241129213833719" style="zoom:33%;" />

<font color='red'>为什么要分层？为什么要制定协议？</font>
计算机网络功能复杂→采用分层结构，将诸多功能合理地划分在不同层次→对等层之间制定协议，以实现功能

<img src="../images/image-20241129213912483.png" alt="image-20241129213912483" style="zoom:33%;" />

#### 垂直视角



<img src="../images/image-20241129214116547.png" alt="image-20241129214116547" style="zoom:33%;" />

<img src="../images/image-20241129214125800.png" alt="image-20241129214125800" style="zoom:33%;" />

<img src="../images/image-20241129214139510.png" alt="image-20241129214139510" style="zoom:33%;" />

<img src="../images/image-20241129214148538.png" alt="image-20241129214148538" style="zoom:33%;" />

<img src="../images/image-20241129214156283.png" alt="image-20241129214156283" style="zoom:33%;" />

<img src="../images/image-20241129214206061.png" alt="image-20241129214206061" style="zoom:33%;" />

### 5.PDU、SDU、PCI 的概念



<img src="../images/image-20241129214234236.png" alt="image-20241129214234236" style="zoom:33%;" />

- <font color='red'>协议数据单元（**PDU**）</font>：对等层次之间传送的数据单位。第 n 层的 PDU 记为 n-PDU
- <font color='red'>服务数据单元（**SDU**）</font>：为完成上一层实体所要求的功能而传送的数据。第 n 层的 SDU 记为 n-SDU。

> OSI将层与层之间交换的数据单位称为服务数据单元SDU

- <font color='red'>协议控制信息（**PCI**）</font>：控制协议操作的信息。第 n 层的 PCI 记为 n-PCI。
- 三者的关系为<font color='red'> n-SDU + n-PCI = n-PDU = (n - 1)-SDU</font>



### 6.协议的三要素



> **<font color='red'>协议</font>**：即 网络协议（Network Protocol），是控制对等实体之间进行通信的规则的集合，<font color='red'>是水平的</font>。



协议由<font color='red'>语法</font>、<font color='red'>语义</font>和<font color='red'>同步</font>三部分组成（协议的三要素）：

1. <font color='red'>语法</font>，数据与控制信息的格式。例如，协议控制信息（首部）部分占几个字节、每个字节是什么含义；协议的数据部分最多有多少字节。
2. <font color='red'>语义</font>，即需要发出何种控制信息、完成何种动作及做出何种应答。例如，协议中需要明确规定：发送方发完数据后，接收方是否需要“应答”，以及“应答”的种类有哪些（如：传输成功、传输失败）
3. <font color='red'>同步</font>（或<font color='red'>**时序**</font>），执行各种操作的条件、时序关系等，即事件实现顺序的详细说明。例如，发送方发完数据后，接收方需要立即应答。如果发送方在10秒内未收到“传输成功”应答，则发送方会再次发送数据。



## 七、OSI参考模型&TCP/IP参考模型



### 知识总览

<img src="../images/image-20241129214615616.png" alt="image-20241129214615616" style="zoom:33%;" />

<img src="../images/image-20241129221134370.png" alt="image-20241129221134370" style="zoom:33%;" />



### 1.关于个别术语的说明



<img src="../images/image-20241129214654093.png" alt="image-20241129214654093" style="zoom: 50%;" />



### 2.记住：各层的名称和顺序



<img src="../images/image-20241129221324044.png" style="zoom:33%;" />

### 3.常见网络设备的功能层次



<img src="../images/image-20241129214923182.png" alt="image-20241129214923182" style="zoom:33%;" />

<img src="../images/image-20241129214935976.png" alt="image-20241129214935976" style="zoom:33%;" />

### 4.OSI参考模型：



#### #1 物理层





<img src="../images/image-20241129215028469.png" alt="image-20241129215028469" style="zoom:33%;" />

<font color='orange'>**物理层**</font>任务：实现相邻节点之间<font color='red'>**比特（0或1）的传输**</font>

1. 需定义电路接口参数（如：形状、尺寸、引脚数等）
2. 需定义传输信号的含义、电气特征（如：5V表示1，1V表示0；每比特电信号持续时间0.1m

<img src="../images/image-20241129215247975.png" alt="image-20241129215247975" style="zoom:33%;" />



#### #2 链路层



<font color='orange'>**链路层**</font>任务：确保相邻节点之间的链路<font color='red'>逻辑上无差错</font>。

包含以下功能



1. <font color='red'>差错控制</font>：检错+纠错：或检错+丢弃+重传
2. <font color='red'>流量控制</font>：协调两个结点的速率

<img src="../images/image-20241129215439499.png" alt="image-20241129215439499" style="zoom:33%;" />



#### #3 网络层



<font color='orange'>**网络层**</font>任务：<font color='red'>把“分组”从源结点转发到目的结点</font>。

包含以下功能

1. <font color='red'>**路由选择**</font>：构造并维护路由表，决定分组到达目的节点的最佳路径
2. <font color='red'>**分组转发**</font>：将“分组”从合适的端口转发出去
3. <font color='red'>拥塞控制</font>：发现网络拥塞，并采取措施缓解拥塞
4. <font color='red'>网际互联</font>：实现异构网络互联
5. 其他功能`（以“分组”为单位）`：<font color='green'>差错控制、连接建立与释放`（确保分组有序、不重复到达）`、流量控制、可靠传输管理</font><font color='green'>`（接收方需返回分组确认消息）`</font>
6. <img src="../images/image-20241129220020065.png" alt="image-20241129220020065" style="zoom: 50%;" />



#### #4 传输层



<font color='orange'>**传输层**</font>任务：实现端到端通信（即实现进程到进程的通信，“端”指“<font color='red'>端口</font>”）

包含以下功能：

1. <font color='red'>**复用和分用**</font>：发送端几个高层实体复用一条低层的连接，在接收端再进行分用。
2. 其他功能`（以报文段为单位）`：<font color='green'>差错控制、流量控制、建立连接与释放`（确保报文段有序、不重复到达）`、可靠传输管理`（接收方需返回报文段确认消息）`</font>

<img src="../images/image-20241129220214337.png" alt="image-20241129220214337" style="zoom:33%;" />

#### #5~#7层



<img src="../images/image-20241129220644767.png" alt="image-20241129220644767" style="zoom:33%;" />

<font color='orange'>**应用层**</font>任务：实现特定的网络应用`（功能繁多，根据应用需求设计）`

<font color='orange'>**表示层**</font>任务：解决不同主机上信息表示不一致的问题`（主要功能：数据格式转换[如 编码转换、压缩/解压、加密/解密]）`

**<font color='orange'>会话层</font>**任务：管理进程间会话`（主要功能：会话管理 [采用检查点机制，当通信失效时从检查点继续恢复通信）`



#### OSI参考模型：各层传输单位

<img src="../images/image-20241129222140230.png" alt="image-20241129222140230" style="zoom:33%;" />

#### 总结



<img src="../images/image-20241129221048114.png" alt="image-20241129221048114" style="zoom:50%;" />

<img src="../images/image-20241129221058317.png" alt="image-20241129221058317" style="zoom:50%;" />



### 5.TCP/IP 模型



#### ①回顾：OSI参考模型#5~#7层

<img src="../images/image-20241129221430948.png" alt="image-20241129221430948" style="zoom:33%;" />

#### #1 应用层



<img src="../images/image-20241129221502233.png" alt="image-20241129221502233" style="zoom:33%;" />

<font color='red'>**应用层任务**</font>：实现特定的网络应用（功能复杂且多样）

> TCP/IP 的理念：如果某些应用需要<u>数据格式转换</u>、<u>会话管理</u>功能，就交给应用层的特定协议去实现



#### ②回顾：OSI参考模型#1~#2层



<img src="../images/image-20241129221723656.png" alt="image-20241129221723656" style="zoom:33%;" />



#### #2 网络接口层



<img src="../images/image-20241129221806329.png" alt="image-20241129221806329" style="zoom:33%;" />

<font color='red'>**网络接口层**</font>任务：实现相邻结点间的数据传输（为网络层传输“分组”）。但==具体怎么传输不作规定==

> 这使得 TCP/IP网络体系结构具有更强的灵活性、适应性





#### #3 网络层



<img src="../images/image-20241129222315547.png" alt="image-20241129222315547" style="zoom:33%;" />

<font color='red'>**TCO/IP网络层功能**</font>：<font color='red'>路由选择、分组转发</font>、拥塞控制、网际互联

> TCP/IP 网络层只保证“尽最大能力交付”，数据传输是不可靠的



#### #4 传输层



<img src="../images/image-20241129222629609.png" alt="image-20241129222629609" style="zoom:33%;" />



<font color='red'>**TCP/IP传输层功能**</font>：<font color='red'>复用和分用</font>、差错控制、流量控制、建立连接与释放、可靠传输管理

> 在TCP/IP 模型中，由传输层负责保证数据传输的正确性、可靠性



#### ③OSI参考模型 vs TCP/IP模型

<img src="../images/image-20241129222030319.png" alt="image-20241129222030319" style="zoom:33%;" />

<img src="../images/image-20241129222041773.png" alt="image-20241129222041773" style="zoom:33%;" />

<img src="../images/image-20241129222921874.png" alt="image-20241129222921874" style="zoom:33%;" />

<img src="../images/image-20241129222938155.png" alt="image-20241129222938155" style="zoom:33%;" />

<img src="../images/image-20241129223106380.png" alt="image-20241129223106380" style="zoom:33%;" />



#### 总结：TCP/IP各层功能



<img src="../images/image-20241129223036440.png" alt="image-20241129223036440" style="zoom:50%;" />





# 第二章 物理层



> 三种常见的计算机网络体系结构

<img src="../images/image-20241201173510419.png" alt="image-20241201173510419" style="zoom:33%;" />

> 数据的传输过程（垂直视角）

<img src="../images/image-20241201173553004.png" alt="image-20241201173553004" style="zoom:33%;" />



## 一、通信基础基本概念



### 知识总览



<img src="../images/image-20241201173645636.png" alt="image-20241201173645636" style="zoom:50%;" />

### 1.信源、信宿、信号、信道



<img src="../images/image-20241201173758222.png" alt="image-20241201173758222" style="zoom:33%;" />



### 2.数字信号、模拟信号



> 可作为信号的物理量：如电压、电磁波 等
>
> 数据传输系统分为模拟传输系统和数字传输系统

<img src="../images/image-20241201173838943.png" alt="image-20241201173838943" style="zoom:33%;" />



### 3.从数学函数的角度理解信号值



> 数字信号、模拟信号

<img src="../images/image-20241201173900157.png" alt="image-20241201173900157" style="zoom:33%;" />



### 4.码元的概念



> 码元、码元宽度
>
> 码元：承载信息量的基本信号单位

<img src="../images/image-20241201173923773.png" alt="image-20241201173923773" style="zoom:33%;" />

> 4进制码元、8进制码元

<img src="../images/image-20241201173943813.png" alt="image-20241201173943813" style="zoom:33%;" />



### 5.用模拟信号设计4进制码元



<img src="../images/image-20241201174150583.png" alt="image-20241201174150583" style="zoom:33%;" />



### 6.重要：码元和比特的关系



一个码元可以携带多少比特数据？

如果一个“<font color='red'>周期</font>”内可能出现<font color='red'> K 种信号</font>，则：

<img src="../images/image-20241201174238139.png" alt="image-20241201174238139" style="zoom: 33%;" />



### 7.速率



<img src="../images/image-20241201174306945.png" alt="image-20241201174306945" style="zoom: 50%;" />

注：若一个码元 携带 n 比特的信息量，则波特率 M Baud 对应的比特率为 Mn b/s。



## 二、传输介质



### 知识总览

<img src="../images/image-20241202201328108.png" alt="image-20241202201328108" style="zoom:50%;" />

### 1.数据的传输过程



<img src="../images/image-20241202201408676.png" alt="image-20241202201408676" style="zoom:33%;" />



------

### 2.导向型传输介质



#### ①双绞线



<img src="../images/image-20241202201432077.png" alt="image-20241202201432077" style="zoom:33%;" />

> 相互绞合可以减少信号之间的相互串扰

##### 双绞线示例



<img src="../images/image-20241202201459761.png" alt="image-20241202201459761" style="zoom:33%;" />

#### ②同轴电缆



<img src="../images/image-20241202201528701.png" alt="image-20241202201528701" style="zoom:33%;" />

内导体越粗，电阻最低，传输过程中信号衰减越少，传输距离越长



##### 同轴电缆示例

<img src="../images/image-20241202201619103.png" alt="image-20241202201619103" style="zoom:33%;" />

#### ③光纤

<img src="../images/image-20241202201643293.png" alt="image-20241202201643293" style="zoom:33%;" />

##### 多模光纤、单模光纤



<img src="../images/image-20241202201731210.png" alt="image-20241202201731210" style="zoom:33%;" />

特点：纤芯更粗，可同时传输<font color='green'>多条光线</font>，信号<font color='green'>传输损耗更高</font>。适合较<font color='green'>近距离传输</font>

<img src="../images/image-20241202201904750.png" alt="image-20241202201904750" style="zoom:33%;" />

特点：纤芯更细，直径小于一个波长，只能传输<font color='skyblue'>一条光线</font>，信号<font color='skyblue'>传输损耗低</font>。适合<font color='skyblue'>远距离传输</font>



##### 光纤示例

<img src="../images/image-20241202202012917.png" alt="image-20241202202012917" style="zoom:33%;" />



#### ④以太网对有线传输介质的命名规则



<img src="../images/image-20241202202042915.png" alt="image-20241202202042915" style="zoom:33%;" />



------



### 3.无线传输介质



<img src="../images/image-20241202202337496.png" alt="image-20241202202337496" style="zoom:50%;" />

本质上都是用电磁波。电磁波的公式：C=λF ，C为光速，λ为波长，F为频率

- 电磁波频率、波长呈反比关系
- <font color='red'>频率越高</font>，<font color='red'>数据传输能力越强</font>
- <font color='red'>波长越短</font>，“信号<font color='red'>指向性</font>”<font color='red'>越强</font>，信号越趋于直线传播
- 波长越长，“绕射性”越好，也就是信号“穿墙”能力越强



结论：<font color='skyblue'>长波</font>更适合长距离、非直线通信。<font color='green'>短波</font>更适合短距离、高速通信，若用于长距离通信需建立中继站；<font color='green'>短波</font>信号指向性强，要求信号

接收器“对准”信号源



#### ①卫星电视（微波通信）示例



<img src="../images/image-20241202202841715.png" alt="image-20241202202841715" style="zoom:33%;" />

<img src="../images/image-20241202202851435.png" alt="image-20241202202851435" style="zoom:33%;" />

### 4.物理层接口的特性



<img src="../images/image-20241202202921641.png" alt="image-20241202202921641" style="zoom:33%;" />

#### 示例：以太网网线接口特性



<img src="../images/image-20241202202943369.png" alt="image-20241202202943369" style="zoom:33%;" />



## 三、物理层设备



### 知识总览



<img src="../images/image-20241202203048858.png" alt="image-20241202203048858" style="zoom: 50%;" />



### 1.中继器（Repeater）



<img src="../images/image-20241202203208999.png" alt="image-20241202203208999" style="zoom:33%;" />

<img src="../images/image-20241202203226872.png" alt="image-20241202203226872" style="zoom: 50%;" />

Eg：物理层“电气特性”规定——0.5~1.5V 是低电平，4.5~5.5V 是高电平，不符合此标准的信号视为无效。中继器接收到信号后，会将低电平整形为1V，将高电平整形为5V，然后再输出



### 2.集线器（Hub）



<img src="../images/image-20241202203257628.png" alt="image-20241202203257628" style="zoom: 50%;" />



#### 冲突域



<img src="../images/image-20241202203330783.png" alt="image-20241202203330783" style="zoom:33%;" />

<font color='red'>==冲突域==：如果两台<u>主机</u>同时发送数据会导致“冲突”，则这两台主机处于同一个“冲突域”。</font>

​		<font color='red'>处于同一冲突域的主机在发送数据前需要进行“==信====道争用==”。</font>



<img src="../images/image-20241202203540168.png" alt="image-20241202203540168" style="zoom:33%;" />

==结论：集线器不能“隔离”冲突域==

<img src="../images/image-20241202203601690.png" alt="image-20241202203601690" style="zoom:33%;" />

<font color='red'>==冲突域==：如果两台主机同时发送数据会导致“冲突”，则这两台主机处于同一个“冲突域”。</font>



### 3.集线器、中继器的一些特性



<img src="../images/image-20241202203647705.png" alt="image-20241202203647705" style="zoom:50%;" />



#### ①集线器、中继器不能“无限串联”——如：10Base5的5-4-3原则



> 5-4-3 原则：使用集线器（或中继器）连接10Base5网段时，最多只能串联5个网段，使用4台集线器（或中继器），只有3个网段可以挂接计算机

<img src="../images/image-20241202203909040.png" alt="image-20241202203909040" style="zoom:33%;" />



#### ②集线器连接的网络，物理上是星形拓扑，逻辑上是总线型拓扑



<img src="../images/image-20241202204030734.png" alt="image-20241202204030734" style="zoom:33%;" />

#### ③集线器连接的各网段“共享带宽”



<img src="../images/image-20241202204140577.png" alt="image-20241202204140577" style="zoom:33%;" />

例如：带宽为10Mbps的集线器，连接8台主机每台主机平均只拥有1.25Mbps带宽



#### ④与教材有冲突部分



<img src="../images/image-20241202204224886.png" alt="image-20241202204224886" style="zoom:50%;" />



# 第三章 数据链路层



## 一、数据链路层的功能



### 知识总览



<img src="../images/image-20241202204448095.png" alt="image-20241202204448095" style="zoom:50%;" />



### 1.数据链路层所处的地位



<img src="../images/image-20241202204531325.png" alt="image-20241202204531325" style="zoom: 33%;" />

<u>数据链路层</u> 使用 <u>物理层</u> 提供的“**==比特传输==**”服务

<u>数据链路层</u> 为 <u>网络层</u> 提供服务，将网络层的 **<font color='blue'>IP数据报（分组）</font>** 封装成**==帧==**，传输给下一个相邻结点

**<font color='red'>物理链路</font>**：传输介质(0层)+物理层(1层) 实现了相邻结点之间的“<font color='red'>物理链路</font>”

**<font color='red'>逻辑链路</font>**：数据链路层需要基于“物理链路”，实现相邻结点之间逻辑上无差错的“<font color='red'>数据链路（逻辑链路）</font>”



## 二、组帧



### 知识总览



<img src="../images/image-20241202204857096.png" alt="image-20241202204857096" style="zoom: 50%;" />



### 1.数据链路层示意图



<img src="../images/image-20241202205130159.png" alt="image-20241202205130159" style="zoom: 33%;" />

### 2.字符计数法



<img src="../images/image-20241202205200044.png" alt="image-20241202205200044" style="zoom:33%;" />

- 原理：在每个帧开头，用一个<font color='red'>定长计数字段</font>表示帧长
- 最大缺点：任何一个计数字段出错，都会导致后续所有帧无法定界



### 3.字节填充法



<img src="../images/image-20241202205244087.png" alt="image-20241202205244087" style="zoom:33%;" />



<img src="../images/image-20241202205257715.png" alt="image-20241202205257715" style="zoom: 33%;" />

<img src="../images/image-20241202205329472.png" alt="image-20241202205329472" style="zoom:33%;" />

如果帧的数据部分包含“特殊字符”，则<font color='red'>发送方</font>需要<font color='red'>在这些“特殊字符”前填充“转义字符 ESC”</font>（<font color='red'>接收方</font>要做<font color='red'>逆处理</font>）



### 4.零比特填充法



<img src="../images/image-20241202205430486.png" alt="image-20241202205430486" style="zoom:33%;" />

<img src="../images/image-20241202205443859.png" alt="image-20241202205443859" style="zoom:33%;" />

- <font color='red'>发送方</font>需要对帧的数据部分进行处理，<font color='red'>每当遇到连续5个1，就填充一个0</font>
- <font color='red'>接受方</font>需要对帧的数据部分进行逆处理，<font color='red'>每当遇到连续5个1，就删掉后面的0</font>



### 5.违规编码法



<img src="../images/image-20241202205554850.png" alt="image-20241202205554850" style="zoom:33%;" />





## 三、差错控制



### 1.数据链路层的“差错控制”功能



<img src="../images/image-20241202205716112.png" alt="image-20241202205716112" style="zoom: 50%;" />



### 2.检错编码——奇偶校验码



#### ①知识总览



<img src="../images/image-20241202205908165.png" alt="image-20241202205908165" style="zoom:50%;" />



#### ②奇偶校验码



**奇校验码**：整个校验码（有效信息位和校验位）中“1”的个数为奇数。

**偶校验码**：整个校验码（有效信息位和校验位）中“1”的个数为偶数。

<img src="../images/image-20241202210000920.png" alt="image-20241202210000920" style="zoom: 50%;" />

【例】 给出两个编码1001101和1010111的奇校验码和偶校验码。

设最高位为校验位，余7位是信息位，则对应的奇偶校验码为：

奇校验： <u>**1**</u>1001101	<u>**0**</u>1010111
偶校验： <u>**0**</u>1001101	<u>**1**</u>1010111



#### ③异或运算



<img src="../images/image-20241202210154658.png" alt="image-20241202210154658" style="zoom:33%;" />



偶校验的硬件实现：各信息进行异或（模2加）运算，得到的结果即为偶校验位

<img src="../images/image-20241202210211127.png" alt="image-20241202210211127" style="zoom:50%;" />





### 3.检错编码——循环冗余校验码

> 循环冗余校验（Cyclic Redundancy Check， <font color='red'>CRC</font>）



#### ①知识总览



<img src="../images/image-20241202210323673.png" alt="image-20241202210323673" style="zoom:33%;" />



#### ②循环冗余校验码的基本思想



<img src="../images/image-20241202210441613.png" alt="image-20241202210441613" style="zoom:33%;" />



<img src="../images/image-20241202210449346.png" alt="image-20241202210449346" style="zoom:50%;" />



循环冗余校验码的思想：

数据发送、接受方约定一个“==除数==”，<font color='red'>K个信息位+R个校验位</font> 作为“<font color='red'>被除数</font>”，添加校验位后需保证<font color='orange'>除法</font>的余数为0。收到数据后，进行<font color='orange'>除法</font>检

查余数是否为0，若余数非0说明出错，则进行重传或纠错



#### ③循环冗余校验码



<img src="../images/image-20241202210633235.png" alt="image-20241202210633235" style="zoom:50%;" />



1. 确定K、R以及生成多项式对应的二进制码

​	K = 信息码的长度 = 6，R = 生成多项式最高次幂 = 3 → 校验码位数**N = K + R** = 9

​	生成多项式G(x) = <font color='red'>1</font> · x³+ <font color='red'>1</font> · x²+ <font color='red'>0</font> · x¹ + <font color='red'>1</font> · xº，对应二进制码<font color='red'>1101</font>

2. 移位

​	信息码左移R位，低位补0

3. 相除

​	对移位后的信息码，用生成多项式进行<font color='red'>模2除法</font>，产生余数

**模2除**:只看被除数最高一位，为1则商填1，不为1则填0

**模2减**：对被除数与商和除数之乘积进行异或运算

<img src="../images/image-20241202211042869.png" alt="image-20241202211042869" style="zoom:50%;" />



<img src="../images/image-20241202211057265.png" alt="image-20241202211057265" style="zoom:50%;" />



​	对应的CRC码：101001 001

4. 检错和纠错

发送：101001001	记为<img src="../images/image-20241202211232859.png" alt="image-20241202211232859" style="zoom: 50%;" />

接收：101001001<img src="../images/image-20241202211259843.png" alt="image-20241202211259843" style="zoom:50%;" />余数为000，代表没有出错

接收：1010010<font color='red'>1</font>1<img src="../images/image-20241202211326118.png" alt="image-20241202211326118" style="zoom:50%;" />余数为010，代表有出错（C₂)

<img src="../images/image-20241202211436129.png" alt="image-20241202211436129" style="zoom: 33%;" />

------



![image-20241202211513008](../images/image-20241202211513008.png)

> 对于确定的生成多项式，出错位与余数是相对应的

<img src="../images/image-20241202211529797.png" alt="image-20241202211529797" style="zoom:50%;" />

理论上可以证明循环冗余校验码的检错能力有以下特点：

1. 可检测出所有奇数个错误；
2. 可检测出所有双比特的错误；
3. 可检测出所有小于等于校验位长度的连续错误；



K个信息位，R个校验位，若生成多项式选择得当，且 2R≥K+R+1，则CRC码可纠正1位错

> 实际应用中一般只用来“检错”



### 4.检错编码——海明校验码



#### ①知识总览

<img src="../images/image-20241203203640915.png" alt="image-20241203203640915" style="zoom:50%;" />

#### ②海明校验码思路简介



奇校验码：整个校验码（有效信息位和校验位）中“1”的个数为奇数。

偶校验码：整个校验码（有效信息位和校验位）中“1”的个数为偶数。

<img src="../images/image-20241203203731167.png" alt="image-20241203203731167" style="zoom:33%;" />

偶校验：1010 —> <u>0</u>1010，能发现奇数位错误，但无法确定是哪一位出错

> 1个校验位之只能携带2种状态信息（对/错）



<font color='red'>海明码</font>设计思路：将信息位分组进行偶校验 —> 多个校验位—>多个校验位标注出错位置

> 多个校验位能携带多种状态信息，（对/错，错在哪）



**需要多少校验位？**

**2^k≥n+k+1**

<img src="../images/image-20241203203915394.png" alt="image-20241203203915394" style="zoom:50%;" />



#### ③海明码求解步骤



<img src="../images/image-20241203204041495.png" alt="image-20241203204041495" style="zoom:33%;" />



信息位：1010

1. **确定海明码的位数**： 2^k≥ n + k + 1
n = 4 —> k = 3

设信息位<img src="../images/image-20241203204153605.png" alt="image-20241203204153605" style="zoom: 50%;" />，共4位，校验位P3P2P1，共3位，对应的海明码为<img src="../images/image-20241203204221196.png" alt="image-20241203204221196" style="zoom:50%;" />

2. **确定校验位的分布**

<img src="../images/image-20241203204250881.png" alt="image-20241203204250881" style="zoom:50%;" />

校验位<img src="../images/image-20241203204319381.png" alt="image-20241203204319381" style="zoom:50%;" />放在海明位号为2^i−1的位置上

信息位按顺序放到其余位置

3. **求校验位的值**

<img src="../images/image-20241203204415152.png" alt="image-20241203204415152" style="zoom:50%;" />

4. **纠错**

<img src="../images/image-20241203204449527.png" alt="image-20241203204449527" style="zoom:50%;" />



<img src="../images/image-20241203204501983.png" alt="image-20241203204501983" style="zoom:50%;" />



##### 格式变化



<img src="../images/image-20241203204529270.png" alt="image-20241203204529270" style="zoom: 33%;" />



<img src="../images/image-20241203204556513.png" alt="image-20241203204556513" style="zoom:33%;" />



#### ④补充

<img src="../images/image-20241203204630276.png" alt="image-20241203204630276" style="zoom:50%;" />



## 四、流量控制、可靠传输与滑动窗口机制



### 1.数据链路层示意图

<img src="../images/image-20241203204914375.png" alt="image-20241203204914375" style="zoom:50%;" />



### 2.流量控制、可靠传输



<img src="../images/image-20241203204940404.png" alt="image-20241203204940404" style="zoom:50%;" />





### 3.滑动窗口机制



<img src="../images/image-20241203205026665.png" alt="image-20241203205026665" style="zoom: 33%;" />

#### ①窗口“向前滑动”的条件



<img src="../images/image-20241203205104035.png" alt="image-20241203205104035" style="zoom:33%;" />

由接收方通过<font color='red'>“确认机制”</font>控制发送方的窗口向前滑动，从而实现<font color='red'>“流量控制”</font>



### 4.重点关注四个方面



<img src="../images/image-20241203205227402.png" alt="image-20241203205227402" style="zoom:50%;" />



### 5.停止-等待协议（S-W）



#### ①知识总览

<img src="../images/image-20241203205417504.png" alt="image-20241203205417504" style="zoom:50%;" />



#### ②停止-等待协议



<img src="../images/image-20241203205459177.png" alt="image-20241203205459177" style="zoom:33%;" />



#### ③数据帧、确认帧、帧序号 的概念



<img src="../images/image-20241203205530675.png" alt="image-20241203205530675" style="zoom:33%;" />



#### ④“正常”情况示例



<img src="../images/image-20241203205559187.png" alt="image-20241203205559187" style="zoom: 33%;" />

<img src="../images/image-20241203205617557.png" alt="image-20241203205617557" style="zoom:33%;" />

<img src="../images/image-20241203205725989.png" alt="image-20241203205725989" style="zoom:33%;" />

<img src="../images/image-20241203205747073.png" alt="image-20241203205747073" style="zoom:33%;" />

<img src="../images/image-20241203205756077.png" alt="image-20241203205756077" style="zoom:33%;" />



#### ⑤异常情况示例：数据帧丢失



<img src="../images/image-20241203205819658.png" alt="image-20241203205819658" style="zoom:33%;" />

<img src="../images/image-20241203205830094.png" alt="image-20241203205830094" style="zoom:33%;" />

<img src="../images/image-20241203205840506.png" alt="image-20241203205840506" style="zoom:33%;" />

<img src="../images/image-20241203205909403.png" alt="image-20241203205909403" style="zoom:33%;" />



#### ⑥异常情况示例：确认帧丢失



<img src="../images/image-20241203205937046.png" alt="image-20241203205937046" style="zoom:33%;" />

<img src="../images/image-20241203205959686.png" alt="image-20241203205959686" style="zoom:33%;" />

<img src="../images/image-20241203210009171.png" alt="image-20241203210009171" style="zoom:33%;" />

<img src="../images/image-20241203210049000.png" alt="image-20241203210049000" style="zoom:33%;" />

#### ⑦探讨：为什么一定要给帧“编号”



<img src="../images/image-20241203210122418.png" alt="image-20241203210122418" style="zoom:33%;" />

**思考**：在刚才这个场景中，<font color='red'>如果没有“帧序号”会发生什么？</font>

答：<font color='red'>接收方无法判别“重复帧”！</font>

由于接受窗口和发送窗口的距离不超过1，因此<font color='red'>用 1 bit 表示帧序号</font>足矣



#### ⑧异常情况示例：数据帧有“差错”



<img src="../images/image-20241203210223152.png" alt="image-20241203210223152" style="zoom:33%;" />

<img src="../images/image-20241203210319503.png" alt="image-20241203210319503" style="zoom:33%;" />

<img src="../images/image-20241203210340683.png" alt="image-20241203210340683" style="zoom:33%;" />

<img src="../images/image-20241203210356614.png" alt="image-20241203210356614" style="zoom:33%;" />

### 6.后退N帧协议（GBN）



#### ①知识总览



<img src="../images/image-20241203210457983.png" alt="image-20241203210457983" style="zoom:50%;" />



#### ②后退N帧协议（GBN）



<img src="../images/image-20241203210539427.png" alt="image-20241203210539427" style="zoom: 33%;" />

**<font color='red'>若用n bit 给帧编号，需满足 WT + WR ≤ 2^n</font>**



#### ③“正常”情况示例





<img src="../images/image-20241203210604564.png" alt="image-20241203210604564" style="zoom:33%;" />

<img src="../images/image-20241203210656353.png" alt="image-20241203210656353" style="zoom:33%;" />

<img src="../images/image-20241203210706436.png" alt="image-20241203210706436" style="zoom:33%;" />

<img src="../images/image-20241203210716840.png" alt="image-20241203210716840" style="zoom:33%;" />

<img src="../images/image-20241203210734957.png" alt="image-20241203210734957" style="zoom:33%;" />

<img src="../images/image-20241203210910703.png" alt="image-20241203210910703" style="zoom:33%;" />

<img src="../images/image-20241203210927737.png" alt="image-20241203210927737" style="zoom:33%;" />



**后退N帧协议规定：**接收方可以“<font color='red'>累积确认</font>”。即连续收到多个数据帧时，<font color='red'>可以仅返回最后一个帧的ACK</font>



#### ④异常情况示例：数据帧丢失



<img src="../images/image-20241203211002598.png" alt="image-20241203211002598" style="zoom:33%;" />

<img src="../images/image-20241203211025671.png" alt="image-20241203211025671" style="zoom:33%;" />

<img src="../images/image-20241203211034256.png" alt="image-20241203211034256" style="zoom:33%;" />

当发现数据帧错误时，直接丢弃，接受下一个数据帧(F)，当收到接受窗口外的帧时，返回上一个正确帧的ACK

<img src="../images/image-20241203211044462.png" alt="image-20241203211044462" style="zoom:33%;" />

<img src="../images/image-20241203211127502.png" alt="image-20241203211127502" style="zoom:33%;" />

<img src="../images/image-20241203211157972.png" alt="image-20241203211157972" style="zoom:33%;" />

<img src="../images/image-20241203211403996.png" alt="image-20241203211403996" style="zoom:33%;" />

<img src="../images/image-20241203211432402.png" alt="image-20241203211432402" style="zoom:33%;" />

<img src="../images/image-20241203211443055.png" alt="image-20241203211443055" style="zoom:33%;" />

<img src="../images/image-20241203211458461.png" alt="image-20241203211458461" style="zoom:33%;" />

#### ⑤异常情况示例：确认帧丢失



<img src="../images/image-20241203211527697.png" alt="image-20241203211527697" style="zoom:33%;" />

<img src="../images/image-20241203211536391.png" alt="image-20241203211536391" style="zoom:33%;" />

<img src="../images/image-20241203211558526.png" alt="image-20241203211558526" style="zoom:33%;" />

<img src="../images/image-20241203211615698.png" alt="image-20241203211615698" style="zoom:33%;" />

<img src="../images/image-20241203211639222.png" alt="image-20241203211639222" style="zoom:33%;" />

#### ⑥探讨：如果不满足 ==WT + WR ≤ 2^n== 会有什么问题？

<img src="../images/image-20241203211710926.png" alt="image-20241203211710926" style="zoom:33%;" />

<img src="../images/image-20241203211721612.png" alt="image-20241203211721612" style="zoom:33%;" />

<img src="../images/image-20241203211740776.png" alt="image-20241203211740776" style="zoom:33%;" />

<img src="../images/image-20241203211812995.png" alt="image-20241203211812995" style="zoom:33%;" />



### 7.选择重传协议（SR）



#### ①知识总览



> SR协议不支持“累计确认”，必须一帧一确认

<img src="../images/image-20241204174232018.png" alt="image-20241204174232018" style="zoom:50%;" />



#### ②选择重传协议的窗口大小限制条件



选择重传协议的<font color='red'>窗口大小需满足如下两个条件</font>：

1. **若用n bit 给帧编号，WT + WR ≤ 2^n**
2. **WR ≤ WT**

<img src="../images/image-20241204174346434.png" alt="image-20241204174346434" style="zoom:33%;" />

<img src="../images/image-20241204174447826.png" alt="image-20241204174447826" style="zoom:33%;" />

<img src="../images/image-20241204174500728.png" alt="image-20241204174500728" style="zoom:33%;" />

#### ③选择重传协议（SR）



<img src="../images/image-20241204174539992.png" alt="image-20241204174539992" style="zoom: 33%;" />

> 在实际应用中，通常取 WT==WR



#### ④“正常”情况示例



<img src="../images/image-20241204200723354.png" alt="image-20241204200723354" style="zoom:33%;" />

> 对比：
>
> <font color='red'>选择重传协议</font>规定：接收方可以连续接收多个帧，但<font color='red'>每个帧都需要返回ACK</font>
> <font color='red'>后退N帧协议</font>规定：接收方可以“<font color='red'>累积确认</font>”。即连续收到多个数据帧时，<font color='red'>可以仅返回最后一个帧的ACK</font>

<img src="../images/image-20241204200745167.png" alt="image-20241204200745167" style="zoom:33%;" />

<img src="../images/image-20241204204100640.png" alt="image-20241204204100640" style="zoom:33%;" />

#### ⑤异常情况示例：数据帧丢失



<img src="../images/image-20241204204143583.png" alt="image-20241204204143583" style="zoom:33%;" />

<img src="../images/image-20241204204157352.png" alt="image-20241204204157352" style="zoom:33%;" />

<img src="../images/image-20241204204206412.png" alt="image-20241204204206412" style="zoom:33%;" />

<img src="../images/image-20241204204215713.png" alt="image-20241204204215713" style="zoom:33%;" />

<img src="../images/image-20241204204224566.png" alt="image-20241204204224566" style="zoom:33%;" />

<img src="../images/image-20241204204239388.png" alt="image-20241204204239388" style="zoom:33%;" />

<img src="../images/image-20241204204250002.png" alt="image-20241204204250002" style="zoom:33%;" />

<img src="../images/image-20241204204323532.png" alt="image-20241204204323532" style="zoom:33%;" />

<img src="../images/image-20241204204332038.png" alt="image-20241204204332038" style="zoom:33%;" />

<img src="../images/image-20241204204342225.png" alt="image-20241204204342225" style="zoom:33%;" />

<font color='red'>**选择重传协议**</font>如何解决数据帧丢失问题：

<font color='red'>超时重传机制</font>：每个帧被发出时设置<font color='red'>计时器</font>，如果<font color='red'>超时未收到</font>对应的ACK，就<font color='red'>重传</font>这个帧



#### ⑥异常情况示例：数据帧因差错而被丢弃



<img src="../images/image-20241204204458572.png" alt="image-20241204204458572" style="zoom:33%;" />

<img src="../images/image-20241204204507767.png" alt="image-20241204204507767" style="zoom:33%;" />

<img src="../images/image-20241204204524079.png" alt="image-20241204204524079" style="zoom:33%;" />

<img src="../images/image-20241204204538006.png" alt="image-20241204204538006" style="zoom:33%;" />

<img src="../images/image-20241204204548565.png" alt="image-20241204204548565" style="zoom:33%;" />

<img src="../images/image-20241204204559202.png" alt="image-20241204204559202" style="zoom:33%;" />

<img src="../images/image-20241204204608309.png" alt="image-20241204204608309" style="zoom:33%;" />

<img src="../images/image-20241204204618932.png" alt="image-20241204204618932" style="zoom:33%;" />

<img src="../images/image-20241204204628255.png" alt="image-20241204204628255" style="zoom:33%;" />

<img src="../images/image-20241204204638440.png" alt="image-20241204204638440" style="zoom:33%;" />

<img src="../images/image-20241204204648180.png" alt="image-20241204204648180" style="zoom:33%;" />



<font color='red'>选择重传协议</font>如何解决数据帧<font color='red'>因差错而被丢弃</font>问题：

**<font color='red'>请求重传机制：</font>**如果接收方收到一个有差错的帧，就<font color='red'>将此帧丢弃</font>，并返回对应的<font color='red'>否认帧NAK_i</font>，主动请求发送方重传 i 号帧



#### ⑦异常情况示例：确认帧丢失



<img src="../images/image-20241204204850359.png" alt="image-20241204204850359" style="zoom:33%;" />

<img src="../images/image-20241204204859554.png" alt="image-20241204204859554" style="zoom:33%;" />

<img src="../images/image-20241204204908587.png" alt="image-20241204204908587" style="zoom:33%;" />

<img src="../images/image-20241204204917493.png" alt="image-20241204204917493" style="zoom:33%;" />

<img src="../images/image-20241204204927248.png" alt="image-20241204204927248" style="zoom:33%;" />

<img src="../images/image-20241204204936352.png" alt="image-20241204204936352" style="zoom: 33%;" />

<img src="../images/image-20241204204946884.png" alt="image-20241204204946884" style="zoom:33%;" />

<img src="../images/image-20241204204954859.png" alt="image-20241204204954859" style="zoom:33%;" />

#### ⑧探讨：如果不满足 ==WT + WR ≤ 2^n== 会有什么问题？



<img src="../images/image-20241204205019616.png" alt="image-20241204205019616" style="zoom:33%;" />

<img src="../images/image-20241204205028956.png" alt="image-20241204205028956" style="zoom:33%;" />

<img src="../images/image-20241204205038261.png" alt="image-20241204205038261" style="zoom:33%;" />

<img src="../images/image-20241204205046625.png" alt="image-20241204205046625" style="zoom:33%;" />

<img src="../images/image-20241204205055674.png" alt="image-20241204205055674" style="zoom:33%;" />

<img src="../images/image-20241204205106912.png" alt="image-20241204205106912" style="zoom:33%;" />

<font color='red'>若不满足WT + WR ≤ 2^n ，会导致发送方和接收方无法正确判别“重复帧”</font>



### 8.三种协议的信道利用率分析



#### ①知识总览



<img src="../images/image-20241204205337084.png" alt="image-20241204205337084" style="zoom:50%;" />

#### ②S-W 协议的信道利用率



**假设：**
信道的数据传输速率= 1 kbps
数据帧长度 = 4 kb
==确认帧长度 = 1 kb==
信道单向传播时延 = 7s

<img src="../images/image-20241204205410772.png" alt="image-20241204205410772" style="zoom: 50%;" />

理想情况下，信道利用率=<img src="../images/image-20241204205448978.png" alt="image-20241204205448978" style="zoom:50%;" />

> 理想情况：没有帧丢失、比特错误等异常情况



------



**假设：**
信道的数据传输速率= 1 kbps
数据帧长度 = 4 kb
==确认帧非常短==
信道单向传播时延 = 7s

<img src="../images/image-20241204205642951.png" alt="image-20241204205642951" style="zoom: 50%;" />

理想情况下，信道利用率=<img src="../images/image-20241204205706540.png" alt="image-20241204205706540" style="zoom:50%;" />，若确认帧非常短，可认为TA = 0

**例题：2018真题_36**

<img src="../images/image-20241204205751687.png" alt="image-20241204205751687" style="zoom:33%;" />



#### ③GBN、SR协议的信道利用率



**假设：**
==发送窗口大小 N=4==
信道的数据传输速率= 1 kbps
数据帧长度 = 4 kb
确认帧长度 = 1 kb
信道单向传播时延 = 7s

<img src="../images/image-20241204205920257.png" alt="image-20241204205920257" style="zoom:50%;" />

理想情况下，信道利用率=<img src="../images/image-20241204205934755.png" alt="image-20241204205934755" style="zoom:50%;" />



------



**假设：**
==发送窗口大小 N=5==
信道的数据传输速率= 1 kbps
数据帧长度 = 4 kb
确认帧长度 = 1 kb
信道单向传播时延 = 7s

<img src="../images/image-20241204210124370.png" alt="image-20241204210124370" style="zoom:50%;" />

理想情况下，信道利用率=<img src="../images/image-20241204210142228.png" alt="image-20241204210142228" style="zoom: 50%;" />

如果<img src="../images/image-20241204210212457.png" alt="image-20241204210212457" style="zoom:50%;" />，则最大信道利用率=1

==注意：信道利用率不可能超过**1**==



**例题：2014真题_36**

<img src="../images/image-20241204210312100.png" alt="image-20241204210312100" style="zoom: 33%;" />

**例题：2015真题_35**

<img src="../images/image-20241204210339289.png" alt="image-20241204210339289" style="zoom:33%;" />



#### ④术语补充



##### ⑴滑动窗口协议



<img src="../images/image-20241204210404429.png" alt="image-20241204210404429" style="zoom: 33%;" />

##### ⑵ARQ协议、连续ARQ协议

<img src="../images/image-20241204210508557.png" alt="image-20241204210508557" style="zoom:33%;" />



## 介质访问控制



## 五、介质访问控制——信道划分



### 1.知识总览



<img src="../images/image-20241205212334392.png" alt="image-20241205212334392" style="zoom:50%;" />



### 2.什么是“介质访问控制”？



==介质访问控制==（Medium Access Control，==MAC==） ：多个节点共享同一个“总线型”广播信道时，可能发生“信号冲突”。

<font color='red'>应该怎么控制各节点对传输介质的访问，才能减少冲突，甚至避免冲突？</font>

<img src="../images/image-20241205212301952.png" alt="image-20241205212301952" style="zoom:33%;" />



### 3.时分复用（TDM）

>  分为同步时分复用和异步时分复用
>
> 时分复用较适用于数字传输

<img src="../images/image-20241205212421775.png" alt="image-20241205212421775" style="zoom:33%;" />

<img src="../images/image-20241205212433875.png" alt="image-20241205212433875" style="zoom:33%;" />

<img src="../images/image-20241205212448633.png" alt="image-20241205212448633" style="zoom:33%;" />

<font color='red'>**时分复用**</font>（Time Division Multiplexing，**<font color='red'>TDM</font>**）—— 将时间分为**等长的“TDM帧”**，每个“TDM帧”又分为**等长的m个“时隙”**，将m个时隙

分配给m对用户（节点）使用

<img src="../images/image-20241205212539776.png" alt="image-20241205212539776" style="zoom:33%;" />

**<font color='red'>TDM的缺点：</font>**

- 每个节点<font color='red'>最多只能分配到信道总带宽的1/m</font>
- 如果某节点暂不发送数据，会导致被分配的“时隙”闲置，<font color='red'>信道利用率低</font>



如何解决？

可统计每个节点对信道的使用需求，<font color='red'>动态按需分配时隙</font>



### 4.统计时分复用（STDM）



<img src="../images/image-20241205212717250.png" alt="image-20241205212717250" style="zoom:33%;" />

<font color='red'>**统计时分复用**</font>（Statistic Time Division Multiplexing，**<font color='red'>STDM</font>**）——又称**异步时分复用**，在TDM的基础上，**动态按序分配时隙**



**<font color='red'>STDM的优点：</font>**

- 如果需要时，一个节点可以在一段时间内<font color='red'>获得所有的信道带宽资源</font>
- 如果某节点暂不发送数据，可以不分配“时隙” ，<font color='red'>信道利用率更高</font>



### 5.频分复用（FDM）



<img src="../images/image-20241205212908165.png" alt="image-20241205212908165" style="zoom:33%;" />

<img src="../images/image-20241205212919251.png" alt="image-20241205212919251" style="zoom:33%;" />

<img src="../images/image-20241205212929450.png" alt="image-20241205212929450" style="zoom:33%;" />

<img src="../images/image-20241205212941459.png" alt="image-20241205212941459" style="zoom:33%;" />

<img src="../images/image-20241205212955491.png" alt="image-20241205212955491" style="zoom:33%;" />

**<font color='red'>频分复用</font>**（Frequency Division Multiplexing，<font color='red'>**FDM**</font>）是<font color='red'>将信道的总频带划分为多个子频带</font>， 每个子频带作为一个子信道，每对用户使

用一个子信道进行通信



**<font color='red'>FDM的优缺点：</font>**

- 优点：各节点可同时发送信号；充分利用了信道带宽（Hz）
- 缺点：FDM技术<font color='red'>只能用于模拟信号</font>的传输



### 6.波分复用（WDM）



<img src="../images/image-20241205213249951.png" alt="image-20241205213249951" style="zoom:33%;" />



**<font color='red'>波分复用</font>**（Wavelength Division Multiplexing，**<font color='red'>WDM</font>**）——即<font color='red'>光的频分复用</font>



Tips：光信号的频带范围（带宽）非常大，因此很适合采用波分复用技术，将一根光纤在逻辑上拆分为多个子信道



### 7.码分复用（CDM）



![image-20241205213344238](../images/image-20241205213344238.png)

背景：2G、3G移动网络时代，节点和节点之间的通信常使用<font color='red'>CDMA</font>（Code Division Multiple Access）技术

> 底层原理就是 <font color='red'>码分复用</font>（Code Division MulNplexing，<font color='red'>CDM</font>）



<img src="../images/image-20241205213439149.png" alt="image-20241205213439149" style="zoom:50%;" />

#### ①各节点用专属“码片序列”发送数据



<img src="../images/image-20241205213507692.png" alt="image-20241205213507692" style="zoom:33%;" />



#### ②信号在传输过程中“叠加”



<img src="../images/image-20241205213527620.png" alt="image-20241205213527620" style="zoom:33%;" />



#### ③从叠加信号中“分离”出各节点发来的数据



<img src="../images/image-20241205213548108.png" alt="image-20241205213548108" style="zoom:33%;" />

<img src="../images/image-20241205213604115.png" alt="image-20241205213604115" style="zoom:33%;" />

<img src="../images/image-20241205213617842.png" alt="image-20241205213617842" style="zoom:33%;" />



#### ④例题：2014真题_37



<img src="../images/image-20241205213643742.png" alt="image-20241205213643742" style="zoom:33%;" />



## 六、介质访问控制——随机访问



### 1.知识总览

<img src="../images/image-20241219105217808.png" alt="image-20241219105217808" style="zoom:50%;" />

<img src="../images/image-20241219105135310.png" alt="image-20241219105135310" style="zoom:50%;" />



### 2.ALOHA协议



<img src="../images/image-20241219105303151.png" alt="image-20241219105303151" style="zoom:33%;" />

<font color=red>纯ALOHA协议</font> <font color='red'>要点</font>：

• 如果准备好数据帧，就==立刻发送==



<img src="../images/image-20241219105510779.png" alt="image-20241219105510779" style="zoom:33%;" />

<font color=red>时隙ALOHA协议 要点：</font>

• ==时隙大小固定 = 传输一个最长帧所需时间==

• ==只有在每个时隙开始时才能发送帧==



#### ①纯ALOHA



<img src="../images/image-20241219105719124.png" alt="image-20241219105719124" style="zoom:33%;" />

#### ②时隙ALOHA



<img src="../images/image-20241219105747672.png" alt="image-20241219105747672" style="zoom:33%;" />

<img src="../images/image-20241219105834325.png" alt="image-20241219105834325" style="zoom:33%;" />



<font color='red'>时隙ALO</font><font color='red'>HA</font>避免了用户发送数据的随意性，<font color='red'>降低了冲突概率</font>，提高了信道的利用率



### 3.CSMA协议



<font color='red'>==CSMA== </font>（Carrier Sense Multiple Access）协议，即<font color='red'> 载波==监听==多路访问协议</font>

CSMA协议在ALOHA协议基础上提出改进：**在发送数据之前，先监听信道是否空闲，只有信道空闲时，才会尝试发送**



<img src="../images/image-20241219110258902.png" alt="image-20241219110258902" style="zoom: 33%;" />

<font color='green'>ALOHA协议</font>——一群无礼匹夫的对话，有话就说，<font color='green'>完全不管别人是不是在说话</font>
<font color='red'>CSMA协议</font>——一群有礼貌的人的对话，<font color='red'>说话前先听听别人是否在说话</font>



#### **①1-坚持CSMA协议**



<img src="../images/image-20241219110413884.png" alt="image-20241219110413884" style="zoom: 33%;" />

<font color='blue'>**优点**</font>：信道利用率高，信道一旦空闲，就可以被下一个节点使用。

<font color='red'>**缺点**：</font>当多个节点都已准备好数据时，一旦信道空闲，会有多个节点同时发送数据，冲突概率大。



#### **②非坚持CSMA协议**



<img src="../images/image-20241219110547521.png" alt="image-20241219110547521" style="zoom:33%;" />



<font color='blue'>**优点**：</font>当多个节点都已准备好数据时，如果信道不空闲，则各节点会<font color='blue'>随机推迟一段时间再尝试监听</font>，从而使<font color='blue'>各节点“错开”发送数据</font>，降低

冲突概率。

<font color='red'>缺点</font>：信道刚恢复空闲时，可能不会被立即利用，导致信道利用率降低



#### ③p-坚持CSMA协议



<img src="../images/image-20241219144410119.png" alt="image-20241219144410119" style="zoom:33%;" />



<font color='blue'>优点：</font>属于1-坚持CSMA、非坚持 CSMA 的折中方案，降低冲突概率的同时，提升信道利用率



### 4.CSMA/CD协议



#### ①知识总览

<img src="../images/image-20241219144639656.png" alt="image-20241219144639656" style="zoom:33%;" />



#### ②CSMA/CD协议要点



<img src="../images/image-20241219144802313.png" alt="image-20241219144802313" style="zoom:33%;" />



#### ③CSMA/CD协议（发送方）



<img src="../images/image-20241219144848812.png" alt="image-20241219144848812" style="zoom:33%;" />



#### ④CSMA/CD协议的“争用期”

> 争用期又称为碰撞窗口



<img src="../images/image-20241219144913986.png" alt="image-20241219144913986" style="zoom:33%;" />

问题1：若A节点往信道上发送数据，最多需要多久可以被其他所有节点“监听”到信号？  →  ==30μs;==

问题2：显然，A节点往信道上发送的数据可能与其他节点发生“冲突”。那么在最极限的情况下，从A节点发出数据开始，<font color='orange'>最多需要多久</font>，A

节点<font color='orange'>一定可以检测到冲突？</font>→  ==2×30μs = 60μs==

<img src="../images/image-20241219145143082.png" alt="image-20241219145143082" style="zoom:33%;" />

#### ⑤CSMA/CD协议“最短帧长”限制



<img src="../images/image-20241219145204570.png" alt="image-20241219145204570" style="zoom:33%;" />

<font color='red'>最短帧长</font>=<font color='red'>2</font>×==30μs==×<font color='red'>10Mbps</font> = <font color='green'>60μs</font> (争用期)×<font color='red'> 10Mbps </font>= ==600bit==

> 特别地，CSMA/CD协议的“冲突停发”规则会导致小于最短帧长的“非法帧”

如果A节点发送的数据帧长度小于 600bit，可能会导致A节点“误以为”发送过程中没有发生冲突，但实际上已经发生了冲突

如果实际要发送的数据很少，可“填充”至合法长度后再发送



#### ⑥CSMA/CD协议（接收方）



<img src="../images/image-20241219145413537.png" alt="image-20241219145413537" style="zoom:33%;" />



#### ⑦CSMA/CD协议“最长帧长”限制



<img src="../images/image-20241219145445264.png" alt="image-20241219145445264" style="zoom:33%;" />



### 5.CSMA/CA协议



#### ①知识总览

<img src="../images/image-20241224160533230.png" alt="image-20241224160533230" style="zoom:50%;" />

#### ②CSMA-各名称解释



**CSMA**——载波<font color='red'>监听</font>多路访问（Carrier Sense Multiple Access）

> 先监听，若信道空闲，再发送



**CSMA/CD**——冲突<font color='red'>检测</font>（==C==ollision ==D==etection）

> 适用于有线网络（如：以太网技术）
>
> 边发送边监听，检测到冲突立即停发



**CSMA/CA**——冲突<font color='red'>避免</font>（==C==ollision ==A==voidance）

> 适用于无线网络（如：IEEE 802.11标准的无线局域网技术，即 WiFi）
>
> 发送过程中不用检测冲突，发送前想办法尽量避免冲突（但无法完全避免）



#### ③无线局域网（WiFi）面临的新问题



<img src="../images/image-20241224160922804.png" alt="image-20241224160922804" style="zoom:33%;" />



<font color='#00b0f0'>**AP（Access Point）——接入点**</font>，也就是你平时连接的无线<font color='#00b0f0'>WiFi热点</font>

> 注：所有移动站点（A~D）都需要和固定站点AP进行通信



<font color='red'>为什么不采用 CSMA/CD 协议？</font>

1. <font color='red'>硬件上很难实现“边听边发，冲突检测”</font>——因为接收信号的强度往往远小于发送信号的强度，且在无线介质上信号强度的动态变化范围很大。

2. <font color='red'>存在“隐蔽站”问题</font>——在无线通信中，并非所有站点都能够听见对方。发送结点处没有冲突并不意味着在接收结点处就没有冲突。

	eg：A无法监听到B、C的信号，B、C对于A而言就是“隐蔽站”。



#### ③什么是 AP？



<img src="../images/image-20241224161300785.png" alt="image-20241224161300785" style="zoom:33%;" />



<font color='#00b0f0'>**AP（Access Point）——接入点**</font>，也就是你平时连接的无线<font color='#00b0f0'>WiFi热点</font>



**家用路由器** = 路由器 + 交换机 + ==其他==

**家用路由器** = 路由器 + 交换机 + ==AP==



<img src="../images/image-20241224161421735.png" alt="image-20241224161421735" style="zoom:33%;" />



**校园网** = 路由器 + n个交换机 + n*m个==AP==



#### ④CSMA/CA协议要点（先不考虑“隐藏站”问题）



<img src="../images/image-20241224161518783.png" alt="image-20241224161518783" style="zoom:50%;" />

<img src="../images/image-20241224161544009.png" alt="image-20241224161544009" style="zoom: 50%;" />

**帧间间隔（Inter Frame Gap）**

<font color='red'>DIFS（分布式协调 IFS）</font>：==最长==的帧间间隔

<font color='red'>SIFS（短IFS）</font>：==最短==的帧间间隔。预留SIFS用于处理收到的帧（如完成差错控制等）



#### ⑤解决“隐蔽站”问题



<img src="../images/image-20241224161711683.png" alt="image-20241224161711683" style="zoom:50%;" />



==Key：先预约，再发送==



<img src="../images/image-20241224161733492.png" alt="image-20241224161733492" style="zoom:50%;" />



> 注1：如果超时未收到CTS，说明预约失败，则“随机退避”后再次RTS预约 

> 注2：“先预约，再发送”这种模式可以启用、也可以不启用。



<font color='red'>**RTS** 控制帧（Request To Send，**请求发送**）</font>——它包括源地址、目的地址和这次通信所需的==持续时间==。

<font color='green'>**CTS** 控制帧（Clear To Send，**允许发送**）</font>——它也包括源地址、目的地址和这次通信所需的==持续时间==。



#### ⑥例题：



2018年真题_35



<img src="../images/image-20241224162000702.png" alt="image-20241224162000702" style="zoom:33%;" />



2020年真题_37

<img src="../images/image-20241224162026648.png" alt="image-20241224162026648" style="zoom:33%;" />





## 七、介质访问控制——轮询访问



### **令牌传递协议**



### 1.历史背景



<img src="../images/image-20241224162555834.png" alt="image-20241224162555834" style="zoom: 33%;" />





### 2.令牌传递协议的工作原理





<img src="../images/image-20241224162623132.png" alt="image-20241224162623132" style="zoom:33%;" /><img src="../images/image-20241224162634302.png" alt="image-20241224162634302" style="zoom:33%;" />



<img src="../images/image-20241224162820871.png" alt="image-20241224162820871" style="zoom:33%;" /><img src="../images/image-20241224162847133.png" alt="image-20241224162847133" style="zoom:28%;" />



<img src="../images/image-20241224162946191.png" alt="image-20241224162946191" style="zoom:30%;" /><img src="../images/image-20241224162958523.png" alt="image-20241224162958523" style="zoom:30%;" />

<img src="../images/image-20241224163046863.png" alt="image-20241224163046863" style="zoom:33%;" /><img src="../images/image-20241224163056976.png" alt="image-20241224163056976" style="zoom:33%;" />

<img src="../images/image-20241224163111982.png" alt="image-20241224163111982" style="zoom:33%;" /><img src="../images/image-20241224163125105.png" alt="image-20241224163125105" style="zoom:33%;" />





<img src="../images/image-20241224163152484.png" alt="image-20241224163152484" style="zoom:30%;" /><img src="../images/image-20241224163203048.png" alt="image-20241224163203048" style="zoom:30%;" />

<img src="../images/image-20241224163225867.png" alt="image-20241224163225867" style="zoom:30%;" /><img src="../images/image-20241224163239095.png" alt="image-20241224163239095" style="zoom:30%;" />

<img src="../images/image-20241224163328888.png" alt="image-20241224163328888" style="zoom:33%;" /><img src="../images/image-20241224163339132.png" alt="image-20241224163339132" style="zoom:33%;" />



### 3.令牌帧、数据帧





<img src="../images/image-20241224163423557.png" alt="image-20241224163423557" style="zoom:50%;" />





### 4.MAU——令牌环网的集中控制站



<img src="../images/image-20241224163634930.png" alt="image-20241224163634930" style="zoom: 33%;" />



<img src="../images/image-20241224163652810.png" alt="image-20241224163652810" style="zoom:33%;" />





## 八、局域网——局域网 & IEEE 802





### 1.知识总览



<img src="../images/image-20241224163834392.png" alt="image-20241224163834392"  />





> 国际标准化工作是由IEEE来制定的



## 九、局域网——局域网的基本概念和结构体系



### 1.知识总览



> 在数据链路层扩展局域网可使用网桥

![image-20241224164020639](../images/image-20241224164020639.png)

<img src="../images/image-20241224164227444.png" alt="image-20241224164227444" style="zoom: 50%;" />

<img src="../images/image-20241224164302823.png" alt="image-20241224164302823" style="zoom: 50%;" />

<img src="../images/image-20241224164329466.png" alt="image-20241224164329466" style="zoom: 33%;" />

<img src="../images/image-20241224164354089.png" alt="image-20241224164354089" style="zoom:33%;" />



### 2.令牌环网



<img src="../images/image-20241224164444973.png" alt="image-20241224164444973" style="zoom:33%;" />



### 3.同轴电缆以太网（+中继器）



<img src="../images/image-20241224164513790.png" alt="image-20241224164513790" style="zoom:33%;" />





### 4.双绞线以太网（集线器连接）



<img src="../images/image-20241224164653193.png" alt="image-20241224164653193" style="zoom:33%;" />



### 5.双绞线以太网（交换机连接）



<img src="../images/image-20241224164827616.png" alt="image-20241224164827616" style="zoom:33%;" />



### 6.双绞线示例



<img src="../images/image-20241224164849180.png" alt="image-20241224164849180" style="zoom:50%;" />





## 十、局域网——以太网 & IEEE 802.3



### 1.知识总览



<img src="../images/image-20241224170436504.png" alt="image-20241224170436504" style="zoom:50%;" />





### 2.IEEE 802 的层次划分



<img src="../images/image-20241224170514447.png" alt="image-20241224170514447" style="zoom:33%;" />



### 3.IEEE 802.3 推出的以太网标准（物理层）



<img src="../images/image-20241224170547276.png" alt="image-20241224170547276" style="zoom:50%;" />



**重点关注：**

支持<font color='#00b050'>全双工</font>or<font color='red'>半双工</font>？



1. **同轴电缆**只能<font color='red'>半双工</font>
2. **==双绞线==**
	- 速率 < 2.5Gbps可支持<font color='red'>半双工</font>or<font color='green'>全双工</font>（节点连接时协商）
	- 速率 ≥ 2.5Gbps仅支持<font color='green'>全双工</font>
3. **光纤**只支持<font color='green'>全双工</font>



#### ①同轴电缆以太网（中继器连接）



<img src="../images/image-20241224170848798.png" alt="image-20241224170848798" style="zoom: 50%;" />

注：不同的网段可以采用不同的标准。==同轴电缆网段仅支持<font color='red'>半</font>双工==



#### ②双绞线以太网（交换机/集线器连接）



<img src="../images/image-20241224170932526.png" alt="image-20241224170932526" style="zoom:50%;" />

注1：做题时默认==交换机==连接的**终端**节点都可以<font color='green'>全双工</font>

注2：用==集线器==连接的节点，仅支持<font color='red'>半双工</font>模式



### 4.两种常见的 以太网MAC层 标准



![image-20241224171048587](../images/image-20241224171048587.png)

> 局域网体系结构中，数据链路层被划分成MAC和LLC两个子层

#### ①V2标准的 以太网MAC帧



<img src="../images/image-20241224171122613.png" alt="image-20241224171122613" style="zoom:50%;" />

> [!IMPORTANT]
>
> ==记忆口诀：6 6 2 N 4，收发协数验==
>
> > N:46~1500



#### ②IEEE 802.3标准的 以太网MAC帧



<img src="../images/image-20241224171242759.png" alt="image-20241224171242759" style="zoom:50%;" />

> [!IMPORTANT]
>
> ==记忆口诀：6 6 2 N 4，收发<font color='red'>长</font>数验==
>
> >  N:46~1500



### 5.回顾：曼彻斯特编码



<img src="../images/image-20241224174134177.png" alt="image-20241224174134177" style="zoom:50%;" />

以太网MAC帧结束定界——违规编码法：

在曼彻斯特编码中，如果信号中间不跳变，就属于“违规编码”，当接收方检测到违规编码时，就知道帧已结束。



### 6.重点：单播帧、广播帧如何传播？



<img src="../images/image-20241224174216402.png" alt="image-20241224174216402" style="zoom:33%;" />

> [!CAUTION]
>
> 注：MAC地址是数据链路层的概念。<font color='#ef7d31'>路由器</font>、<font color='#07b0f0'>交换机</font><font color='red'>都有MAC地址</font>，而<font color='#70ad47'>集线器</font><font color='red'>没有MAC地址</font>



<font color='#07b0f0'>单播帧：</font>

A → C 	仅C能收到并接收帧
A → F 	 E、F、G 能收到，仅F会接收帧
E → A 	 F、G、A 能收到，仅A会接收帧
E → F 	 F、G能收到，仅F会接收帧



<font color='red'>广播帧（目的地址全为1）：</font>

A发出广播帧，B、C、D、E、F、G、R都能收到并接收帧

E发出广播帧，A、B、C、D、F、G、R都能收到并接收帧



> [!CAUTION]
>
> 注意：路由器R收到广播帧后，不会再转发至其他网络。只有同一个局域网内的各节点才属于同一个“广播域”



### 7.冲突域、广播域



<img src="../images/image-20241224174622566.png" alt="image-20241224174622566" style="zoom:50%;" />

**<font color='red'>冲突域</font>**：如果两个节点同时发送数据，会导致冲突，则二者处于同一个“<font color='red'>冲突域</font>”

**<font color='red'>广播域</font>**：如果一个节点发送广播帧，可以被另一个节点接收，则二者处于同一个“<font color='red'>广播域</font>”



## 十一、局域网——VLAN（虚拟局域网）



### 知识总览



### 1.一个大型局域网（如校园网）面临的问题



<img src="../images/image-20241224175155383.png" alt="image-20241224175155383" style="zoom:33%;" />



1. 局域网内任何一个节点发出的广播帧，都会被广播至所有节点。可能出现“广播风暴”。
2. 不安全，局域网内可能会有一些敏感节点



### 2.VLAN（虚拟局域网）



<img src="../images/image-20241224175229859.png" alt="image-20241224175229859" style="zoom: 33%;" />



- 可将一个大型局域网分割成若干个较小的VLAN，==每个VLAN是一个广播域==
- 需要使用**支持VLAN功能的以太网交换机**来实现
- 每个VLAN对应一个==VID==

> 虚拟局域网不是一种新型局域网

### 3.VLAN划分方式



#### ①基于接口



<img src="../images/image-20241224175338117.png" alt="image-20241224175338117" style="zoom:33%;" />



#### ②基于MAC地址



<img src="../images/image-20241224175356739.png" alt="image-20241224175356739" style="zoom:33%;" />



#### ③基于IP地址



<img src="../images/image-20241224175416338.png" alt="image-20241224175416338" style="zoom:33%;" />

> [!CAUTION]
>
> 注：这种方式<font color='red'>可以让VLAN范围跨越路由器，让多个局域网的主机组成一个VLAN</font>（需要<font color='red'>网络层</font>功能支持）



### 4.802.1Q 帧的作用



<img src="../images/image-20241224175510946.png" alt="image-20241224175510946" style="zoom:33%;" />

<font color='#447dd9'>主机</font>与<font color='red'>交换机</font>之间，传输==标准以太网帧==

<font color='red'>交换机</font>与<font color='red'>交换机</font>之间，传输 ==802.1Q 帧==



### 5.802.1Q 帧的结构



<img src="../images/image-20241224175624809.png" alt="image-20241224175624809" style="zoom:33%;" />



<img src="../images/image-20241224175640405.png" alt="image-20241224175640405" style="zoom:50%;" />



## 十二、局域网——IEEE 802.11 无线局域网



### 知识总览



<img src="../images/image-20241226110745885.png" alt="image-20241226110745885" style="zoom:50%;" />

> 无限局域网可以分为两大类，即有固定基础设施的和无固定基础设施的
>
> 无固定基础设施的无限局域网又叫做自组网络

### 1. 一个普通家用路由器的硬件架构



<img src="../images/image-20241226111218636.png" alt="image-20241226111218636" style="zoom:33%;" />



<img src="../images/image-20241226111250303.png" alt="image-20241226111250303" style="zoom:33%;" />





### 2. 802.11无线局域网的基本概念



<img src="../images/image-20241226111352721.png" alt="image-20241226111352721" style="zoom:33%;" />



- ==802.11无线局域网==是==星形拓扑==，中心称为<font color='red'>接入点（AP）</font>，也可称为<font color='red'>无线接入点（WAP）</font>

	>  说人话：你连接的WiFi热点

- <font color='blue'>基本服务集BSS</font>：1个<u>基站</u>（AP)+多个移动站

	> 说人话：一个WiFi热点连了很多台手机电脑

	- <font color='green'>服务集标识符SSID</font>：也就是无线局域网的名字，不超过32字节

		> 说人话：WiFi名字

	- <font color='orange'>基本服务区BSA</font>：指一个基本服务集能够覆盖的地理范围

		> 说人话：站在哪里可以收到WiFi？

- 门户（Portal）：可将802.11无线局域网接入802.3有线以太网

- 扩展服务集ESS：将多个AP连接到同一个分配系统，组成一个更大的服务集

	> 说人话：全屋WiFi
	>
	> <img src="../images/image-20241226174648376.png" alt="image-20241226174648376" style="zoom:33%;" />

- 漫游：一个移动站从一个基本服务集切换到另一个基本服务集，仍然可以保持通信

	>  说人话：丝滑切换WiFi热点
	>
	> <img src="../images/image-20241226174955924.png" alt="image-20241226174955924" style="zoom:33%;" />



### 3. 802.11帧的分类



①<font color='red'>数据帧</font>

②<font color='red'>控制帧</font>：如ACK、RTS、CTS帧

③<font color='red'>管理帧</font>：如探测请求/探测响应帧

> 说人话：探测请求——用于发现WiFi

<img src="../images/image-20241226175251921.png" alt="image-20241226175251921" style="zoom:33%;" />



### 4. 802.11局域网的数据帧格式



<img src="../images/image-20241226175532467.png" alt="image-20241226175532467" style="zoom: 33%;" />



> [!CAUTION]
>
> 注意：在802.11无线局域网内，两个移动站之间不能直接通信，必须通过基站（AP）转发



> [!TIP]
>
> 记忆口诀：
>
> - ==30 N 4 首数验，首部3+1地址==
>
> > 数据帧格式分为：MAC首部（30字节）、帧主体（N[0~2312]字节）、MAC尾部（4字节），首部有三个重要地址与一个次要地址
>
> - ==九、十比特表去来，帧的中转靠AP==
>
> > 在帧控制字节中，第九、十位代表去往AP与来自AP，AB基站之间不能直接传输数据帧，只能通过AP中转
>
> - ==去往AP中起止，来自AP止起中==
>
> > 若数据帧是去往AP的，那么地址1、2、3对应着中转地址、起始地址、终止地址；若数据帧是来自AP，则地址1、2、3对应着终止地址、起始地址、中转地址



### 5. 2017年真题35



<img src="../images/image-20241226180411944.png" alt="image-20241226180411944" style="zoom:50%;" />



> [!CAUTION]
>
> 注1: 802.11帧用于无线链路传输，通常是AP与移动站之间的传输
>
> 注2：在有线链路上通常使用以太网帧格式，AP与AP之间、AP与路由器之间、AP与以太网交换机之间使用有线链路
>
> AP通常具备“帧格式转换”功能。可以将在无线链路上传输的802.11帧格式，与有线链路上传输的以太网帧格式相互转换



### 6. 拓展：RTS、CTS、ACK帧格式



<img src="../images/image-20241226180908067.png" alt="image-20241226180908067" style="zoom:50%;" />



## 十三、广域网



### 知识总览



<img src="../images/image-20241226194627784.png" alt="image-20241226194627784" style="zoom:33%;" />



### 1. 广域网



**广域网**（WAN，WideAreaNetwork），通常跨接很大的物理范围，所覆盖的范围从几十公里到几千公里，它能连接多个城市或国家，或横跨几个洲并能提供远距离通信，形成国际性的远程网络。

广域网的通信子网主要使用<font color='red'>分组交换</font>技术。广域网的通信子网可以利用公用分组交换网、卫星通信网和无线分组交换网，它将分布在不同地区的**局域网或计算机系统**互连起来，达到<font color='red'>资源共享</font>的目的。如因特网（Internet）是世界范围内最大的广城网



<img src="../images/image-20241226194825567.png" alt="image-20241226194825567" style="zoom:33%;" />



### 2. PPP协议的特点



点对点协议PPP（Point-to-PointProtocol）是目前使用最广泛的数据链路层协议，用户使用拨号电话接入因特网时一般都使用PPP协议。

> [!IMPORTANT]
>
> 只支持全双工链路
>
> 是面向字符的协议



### 3. PPP协议应满足的要求



- **简单**——对于链路层的，无需纠错，无需序号，无需流量控制。
- **封装成顿**——帧定界符
- **透明传输**——与帧定界符一样比特组合的数据应该如何处理：异步线路用字节填充，同步线路用比特填充
- **多种网络层协议**——封装的IP数据报可以采用多种协议。
- **多种类型链路**——串行/并行，同步/异步，电/光...
- **差错检测**——错就丢弃。
- **检测连接状态**——链路是否正常工作。
- **最大传送单元**——数据部分最大长度MTU。
- **网络层地址协商**——知道通信双方的网络层地址



### 4. PPP协议无需满足的要求



- **纠错**
- **流量控制**
- **序号**
- **不支持多点线路**



### 5. PPP协议的三个组成部分



1. 一个将IP数据报封装到串行链路（同步串行/异步串行）的方法
2. 链路控制协议**LCP**：建立并维护数据链路连接。<font color='red'>身份验证</font>
3. 网络控制协议**NCP**：PPP可支持多种网络层协议，每个不同的网络层协议都要一个相应的NCP来配置，为网络层协议建立和配置逻辑连接。



### 6. PPP协议的状态图



<img src="../images/image-20241226195411521.png" alt="image-20241226195411521" style="zoom:50%;" />



### 7. PPP协议的帧格式



<img src="../images/image-20241226195441519.png" alt="image-20241226195441519" style="zoom:33%;" />



### 8. HDLC协议



高级数据链路控制（High-LevelDataLinkControl或简称HDLC），是一个在同步网上传输数据、**面向比特**的数据链路层协议，它是由国际标准化组织(<font color='red'>ISO</font>)根据IBM公司的SDLC(SynchronousDataLinkControl)协议扩展开发而成的

数据报文可透明传输，用于实现透明传输的“o比特插入法”易于硬件实现

<font color='red'>采用全双工通信</font>



### 9. HDLC的站



#### 主站、从站、复合站



1. 主站的主要功能是发送命令（包括数据信息）、接收响应帧，并负责对整个链路的控制系统的初启、流程的控制、差错检测或恢复等。
2. 从站的主要功能是接收由主站发来的命令顺，向主站发送响应顿，并且配合主站参与差错恢复等链路控制。
3. 复合站的主要功能是既能发送，又能接收命令帧和响应帧，并且负责整个链路的控制。

<font color='red'>三种数据操作方式：</font>

1. 正常响应方式
2. 异步平衡方式
3. 异步响应方式



### 10. HDLC的帧格式



<img src="../images/image-20241226195743518.png" alt="image-20241226195743518" style="zoom:50%;" />



1. 信息帧（1）第1位为<font color='red'>0</font>，用来<font color='orange'>传输数据信息</font>，或使用挡带技术对数据进行确认；
2. 监督帧（S）<font color='red'>10</font>，用于<font color='orange'>流量控制和差错控制</font>，执行对信息顿的确认、请求重发和请求暂停发送等功能
3. 无编号（U）<font color='red'>11</font>，用于提供对<font color='orange'>链路</font>的建立、拆除等多种控制功能



### 11. PPP协议&HDLC协议



HDLC、PPP只支持<font color='red'>全双工</font>链路，

都可以实现透明传输。

都可实现差错检测但不纠正差错



<img src="../images/image-20241226200023323.png" alt="image-20241226200023323" style="zoom:50%;" />





## 十四、以太网交换机



### 知识总览



<img src="../images/image-20241226200150564.png" alt="image-20241226200150564" style="zoom:50%;" />



### 1. 以太网交换机的自学习功能



<img src="../images/image-20241226200413645.png" alt="image-20241226200413645" style="zoom: 50%;" />

<img src="../images/image-20241226200459062.png" alt="image-20241226200459062" style="zoom: 50%;" />





### 2. 交换机：直通交换 vs 存储转发交换



<img src="../images/image-20241226200637417.png" alt="image-20241226200637417" style="zoom:33%;" />

#### <font color='red'>直通式交换方式</font>



**优点：**转发时延低

**缺点：**不适用于需要速率匹配、协议转换或差错检测的线路



#### <font color='red'>存储转发交换方式</font>



**优点：**适用于需要速率匹配、协议转换或差错检测的线路

**缺点：**转发时延高



### 3. 例题：2013年真题38



<img src="../images/image-20241226201044607.png" alt="image-20241226201044607" style="zoom:50%;" />





# 第四章 网络层



**网络层所处的地位**



<img src="../images/image-20250103201553879.png" alt="image-20250103201553879" style="zoom:50%;" />

==网络层== 为 传输层 提供服务，将传输层的数据封装成“==IP数据报==”。网络中的路由器根据IP数据报首部中的==源IP地址==、==目的IP地址==进行“分组转发”。因此，网络层实现了“==主机到主机==”的传输

数据链路层 为 网络层 提供服务，将网络层的<font color='BLUE'> IP数据报</font>（分组） 封装成<font color='red'>**帧**</font>，传输给下一个==相邻结点==



**查一查：你的电脑的公网IP地址**



<img src="../images/image-20250103202035930.png" alt="image-20250103202035930" style="zoom: 50%;" />





## 一、网络层的功能



### 知识总览



<img src="../images/image-20250103202200821.png" alt="image-20250103202200821" style="zoom: 50%;" />



### 图例



<img src="../images/image-20250103202220553.png" alt="image-20250103202220553" style="zoom:50%;" />

注1：接入网络的每台主机至少拥有一个IP地址

注2：通常，路由器的每个接口都需要分配一个IP地址（最新技术标准已经取消了这个强制要求）



## 二、IPV4分组



### 知识总览



<img src="../images/image-20250103203358756.png" alt="image-20250103203358756" style="zoom:50%;" />

### 1.各种协议之间的服务关系



<img src="../images/image-20250103203432350.png" alt="image-20250103203432350" style="zoom:50%;" />

<font color='red'>IP协议（Internet Protocol，网际协议）是互联网的核心！</font>

==ARP协议==用于查询同一网络中的<主机IP地址, MAC地址>之间的映射关系

ICMP协议用于网络层实体之间相互通知“异常事件”

IGMP协议用于实现IP组播



### 2.IP数据报（IP分组）的格式



<img src="../images/image-20250103203602211.png" alt="image-20250103203602211" style="zoom:50%;" />

**例：2012年真题47（大题）**



<img src="../images/image-20250103203622141.png" alt="image-20250103203622141" style="zoom:50%;" />



<img src="../images/image-20250103203714117.png" alt="image-20250103203714117" style="zoom:50%;" />

![image-20250103204137239](../images/image-20250103204137239.png)

<font color='red'>TTL的初始值通常由源主机设置。</font>

<font color='red'>每经过一个路由器，路由器就将TTL减1，如果TTL减到0，就直接丢弃分组，并向源主机发送ICMP报文</font>

<font color='red'>注：ICMP报文用于通知一个节点发生了某种“异常”</font>

<img src="../images/image-20250103204458784.png" alt="image-20250103204458784" style="zoom:50%;" />

![image-20250103204508022](../images/image-20250103204508022.png)

### 3.IP数据报的“分片”问题



<img src="../images/image-20250103203743460.png" alt="image-20250103203743460" style="zoom:50%;" />



==以太网MAC帧记忆口诀：6 6 2 N 4，收发协数验==（N：46~1500）

<font color='red'>重要概念：一个链路层数据帧能承载的最大数据量称为<u>最大传送单元（MTU</u>）。如以太网的MTU=1500B</font>

<font color='red'>如果一个IP数据报的总长度超出了下一段链路的MTU，就需要分片</font>

<img src="../images/image-20250103203925901.png" alt="image-20250103203925901" style="zoom:50%;" />



<img src="../images/image-20250103203942909.png" alt="image-20250103203942909" style="zoom:50%;" />

注意：

- IP数据报的“<font color='red'>分片</font>”可能在<font color='red'>源主机、或任何一个路由器</font>font>中发生
- 只有<font color='skyblue'>目的主机</font>才会对分片进行“<font color='skyblue'>重组</font>”
- 各分片有可能乱序到达目的主机
- 由于首部的“片偏移”字段是以<u>×8B</u> 为单位，因此，==除了最后一个分片外，其他每个分片的数据部分必须是8B的整数倍==

<img src="../images/image-20250103204054265.png" alt="image-20250103204054265" style="zoom:50%;" />



### 4.IP数据报的生存时间“TTL”（可达示例）



![image-20250103204354468](../images/image-20250103204354468.png)



### 5.IP数据报的生存时间“TTL”（不可达示例）



<img src="../images/image-20250103204433664.png" alt="image-20250103204433664" style="zoom:50%;" />



## 三、IP地址



> 最初的分类方案
>
> IP地址不能直接用来通信，在实际的网络的链路上传送数据帧必须使用硬件地址



### 1.IP数据报（IP分组）的格式



![image-20250103204644600](../images/image-20250103204644600.png)



### 2.最初的IP地址分类方案



<img src="../images/image-20250103204958260.png" alt="image-20250103204958260" style="zoom:50%;" />



时代背景：IPv4协议是1981年发明的，当时只有政府、学校、军队等大机构会使用互联网。完全没有预料到互联网用户会迎来爆炸性增长。因此IPv4协议中，地址位数仅设计了32bit（232≈42亿）



注：IP 地址资源由ICANN（互联网名字和数字分配机构 ）进行分配（有偿租用）



![image-20250103205031305](../images/image-20250103205031305.png)

- 在那个年代，要求==每台主机、每个路由器接口被分配的IP地址都是全球唯一的==
- <font color='red'>路由器和路由器连接的接口可以不分配IP地址，但路由器和其他节点连接的接口必须分配IP地址</font>
- 从属于<font color='red'>同一个网络的所有主机、路由器接口的IP地址“网络号”都相同</font>
- 当一台<font color='red'>新主机接入网络时</font>，需要给它<font color='red'>分配一个IP地址</font>、并配置<font color='red'>“默认网关”</font>



![image-20250103205145031](../images/image-20250103205145031.png)

![image-20250103205201637](../images/image-20250103205201637.png)



### 3.一些特殊用途的IP地址



| 网络号 | 主机号               | 作为分组源地址？ | 作为分组目的地址？ | 代表的含义                                                |
| ------ | -------------------- | ---------------- | ------------------ | --------------------------------------------------------- |
| Y      | 全0                  | ✘                | ✘                  | 表示整个网络本身（只能用于路由表、转发表）                |
| Y      | 全1                  | ✘                | ✔                  | 向网络号为Y的网络广播IP分组                               |
| 0      | Y                    | ✔                | ✘                  | 表示本网络中主机号为Y的主机                               |
| 全0    | 全0                  | ✔                | ✘                  | 本网络上的本主机（会在DHCP协议中使用）                    |
| 全1    | 全1                  | ✘                | ✔                  | 向本网络广播IP分组                                        |
| 127    | 非全0或非全1的任何数 | ✔                | ✔                  | 环回自检地址。表示一台主机本身，用于本地<br/>软件环回测试 |

> [!CAUTION]
>
> 注意：以上这些特殊地址不能指派给网路中的任何一台主机或路由器“私用”

> [!IMPORTANT]
>
> 重要结论：前两行说明，如果一个网络中，主机号占 N bit，那么这个网络中，最多支持2N-2台主机&路由器





<img src="../images/image-20250103205626188.png" alt="image-20250103205626188" style="zoom:33%;" />

<img src="../images/image-20250103205639931.png" alt="image-20250103205639931" style="zoom:33%;" />

<img src="../images/image-20250103205649430.png" alt="image-20250103205649430" style="zoom:33%;" />

<img src="../images/image-20250103205658484.png" alt="image-20250103205658484" style="zoom:33%;" />

<img src="../images/image-20250103205711574.png" alt="image-20250103205711574" style="zoom:33%;" />

## 四、子网划分&子网掩码



### 知识总览



<img src="../images/image-20250103205834540.png" alt="image-20250103205834540" style="zoom:50%;" />

<img src="../images/image-20250103205852196.png" alt="image-20250103205852196" style="zoom:50%;" />

<img src="../images/image-20250103205908768.png" alt="image-20250103205908768" style="zoom:50%;" />



### 画图训练



<img src="../images/image-20250103210109958.png" alt="image-20250103210109958" style="zoom:50%;" />

<img src="../images/image-20250103210221516.png" alt="image-20250103210221516" style="zoom:50%;" />

<img src="../images/image-20250103210239937.png" alt="image-20250103210239937" style="zoom:50%;" />

<img src="../images/image-20250103210253749.png" alt="image-20250103210253749" style="zoom:50%;" />

<img src="../images/image-20250103210303807.png" alt="image-20250103210303807" style="zoom:50%;" />

<img src="../images/image-20250103210315198.png" alt="image-20250103210315198" style="zoom:50%;" />

<img src="../images/image-20250103210331592.png" alt="image-20250103210331592" style="zoom:50%;" />

<img src="../images/image-20250103210342706.png" alt="image-20250103210342706" style="zoom:50%;" />

<img src="../images/image-20250103210354653.png" alt="image-20250103210354653" style="zoom:50%;" />

<img src="../images/image-20250103210407812.png" alt="image-20250103210407812" style="zoom:50%;" />



## 五、无分类编址



### 知识总览



<img src="../images/image-20250104161018443.png" alt="image-20250104161018443" style="zoom:50%;" />



### 1.传统的IP地址分配方案有什么缺陷？



<img src="../images/image-20250104161053042.png" alt="image-20250104161053042" style="zoom:33%;" />



eg：某单位有2000台主机想要联网，就不得不申请一个B类地址块

<font color='red'>IP地址资源分配不灵活，利用率低，有限的IP地址资源将很快耗尽</font>



### 2.无分类编址 CIDR



<img src="../images/image-20250104161337247.png" alt="image-20250104161337247" style="zoom:33%;" />

eg：某单位有2000台主机想要联网，IP地址管理机构可以给他分配一个<font color='red'>21bit网络前缀</font>的==CIDR地址块==

<img src="../images/image-20250104161409360.png" alt="image-20250104161409360" style="zoom: 33%;" />



### 3.定长子网划分、变长子网划分



一个单位获得CIDR地址块后，可以把它划分为多个子网

> CIDR将网络前缀都相同的连续的IP地址组成CIDR地址块

<font color='red'>定长子网划分</font>：在一个CIDR地址块中，把主机号前 k bit 抠出来作为定长子网号，这样就能划分出 2^k 个子网（每个子网包含的IP地址块大小相等）

> 与传统的子网划分技术同理



<font color='red'>变长网划分</font>：在一个CIDR地址块中，划分子网时，==子网号长度不固定==（每个子网包含的IP地址块大小不同）

> 子网划分更灵活！



### 4.传统的“定长子网划分” 方案有什么缺陷？



假设：某学校申请了一个IP地址块，166.1.X.X

<img src="../images/image-20250104161639230.png" alt="image-20250104161639230" style="zoom:50%;" />

<font color='red'>定长子网划分：</font>font>在申请一个IP地址块后，把<font color='skyblue'>**nbit主机号**</font>的<font color='#04ea0c'>**前 k bit**</font> 抠出来作为<font color='red'>子网号</font>，这样就能划分出 <font color='#04ea0c'>**2^k 个定长子网**</font>（每个子网包含的IP地址块大小相等，都包含 2^(n-k) 个IP地址）

<font color='red'>缺点：</font><font color='red'>每个子网都一样大，不够灵活，IP地址利用率低，浪费有限的IP地址资源</font>



### 5.例子



#### 例1：无分类编制 CIDR、变长子网划分的应用



<img src="../images/image-20250104162236555.png" alt="image-20250104162236555" style="zoom:50%;" />



#### 例2：无分类编制 CIDR、变长子网划分的应用



<img src="../images/image-20250104162300527.png" alt="image-20250104162300527" style="zoom:50%;" />

<img src="../images/image-20250104162514702.png" alt="image-20250104162514702" style="zoom:50%;" />

<img src="../images/image-20250104162316374.png" alt="image-20250104162316374" style="zoom:50%;" />

**<font color='red'>CIDR地址块的子网划分技巧：</font>**可以利用类似于“**<font color='red'>从根到叶构造二叉哈夫曼树</font>**”的技巧

- <font color='red'>原始CIDR地址块</font>作为<font color='red'>根节点</font>（假设可以自由分配的主机号占 h bit）
- 每个分<font color='red'>支节点必须同时拥有左右孩子</font>，左0，右1（反过来也行）
- 每个<font color='red'>叶子结点</font>对应一个<font color='red'>子网</font>，根据<font color='red'>根节点到达叶子结点的路径</font>来分析<font color='red'>子网</font>对应的<font color='red'>IP地址块范围</font>
- <font color='red'>整棵树的高度不能超过 h-1 </font>（因为即便最小的子网也至少要保留 2bit 主机号）



### 6.例题



#### 2017真题_38：定长子网划分

<img src="../images/image-20250104162605353.png" alt="image-20250104162605353" style="zoom: 33%;" />

#### 2019真题_37：变长子网划分

<img src="../images/image-20250104162630183.png" alt="image-20250104162630183" style="zoom: 33%;" />



## 六、路由聚合



### 1.路由聚合



对于一个路由转发表，如果几条路由表项的<font color='red'>转发接口相同</font>，<font color='red'>部分网络前缀也相同</font>，那么可以<font color='orange'>将这几条路由表项聚合为一条</font>。这种地址的聚合称为<font color='red'><u>路由聚合</u></font>，也称<font color='red'><u>构成超网</u></font>。



<img src="../images/image-20250104162933692.png" alt="image-20250104162933692" style="zoom: 33%;" />

- 路由聚合<font color='green'>可以减少路由表的大小</font>。
- 路由聚合<font color='orange'>可能会引入额外的无效地址</font>。如：128.14.32.156/30



### 2.最长前缀匹配原则



假设：
县里的电信路由器收到一个来自互联网的IP数据报，目的IP地址=<font color='blue'>128.14.32.131</font>



<img src="../images/image-20250104163051275.png" alt="image-20250104163051275" style="zoom:50%;" />



假设：
县里的电信路由器收到一个来自互联网的IP数据报，目的IP地址=<font color='green'>128.14.32.153</font>

![image-20250104163155786](../images/image-20250104163155786.png)



### 3.非常重要！理解了就能分析很多大题



<img src="../images/image-20250104163226113.png" alt="image-20250104163226113" style="zoom:50%;" />

<img src="../images/image-20250104163237094.png" alt="image-20250104163237094" style="zoom:50%;" />



### 4.例图综合



<img src="../images/image-20250104163339115.png" alt="image-20250104163339115" style="zoom:50%;" />



## 七、网络地址转换——NAT



### 知识总览

<img src="../images/image-20250104163449055.png" alt="image-20250104163449055" style="zoom:50%;" />



### 1.传输层“端口号”的概念



<img src="../images/image-20250104163521044.png" alt="image-20250104163521044" style="zoom:50%;" />

<font color='#00b0f0'>网络层</font>实现了“<u>主机到主机</u>”的通信。网络层在IP数据报的首部，指明<font color='#00b0f0'>源IP地址、目的IP地址</font>

传输层实现了“<u>端到端</u>”（<u>进程到进程</u>）的通信。传输层在 TCP(或UDP)报文段的首部，指明<font color='red'>源端口、目的端口</font>



### 2.数据的传输过程（垂直视角）



<img src="../images/image-20250104164417905.png" alt="image-20250104164417905" style="zoom: 50%;" />



### 3.如何缓解IP地址不够用的问题？



IP地址 32bit，2^32≈42亿，如果每台主机都要消耗一个全球唯一的IP地址，显然不够用

<img src="../images/image-20250104164503947.png" alt="image-20250104164503947" style="zoom:33%;" />



### 4.NAT原理示意



![image-20250104164549020](../images/image-20250104164549020.png)

<img src="../images/image-20250104164641117.png" alt="image-20250104164641117" style="zoom:50%;" />

<img src="../images/image-20250104164652680.png" alt="image-20250104164652680" style="zoom:50%;" />

<img src="../images/image-20250104164702408.png" alt="image-20250104164702408" style="zoom:50%;" />

### 5.例图综合



<img src="../images/image-20250104164749074.png" alt="image-20250104164749074" style="zoom:50%;" />

<img src="../images/image-20250104164802860.png" alt="image-20250104164802860" style="zoom:50%;" />



## 八、地址解析协议——ARP



> Address Resolution Protocol



### 知识总览



<img src="../images/image-20250104164914553.png" alt="image-20250104164914553" style="zoom:50%;" />



### 1.各种协议之间的服务关系



<img src="../images/image-20250104164958253.png" alt="image-20250104164958253" style="zoom:50%;" />

**<font color='red'>IP协议（Internet Protocol，网际协议）是互联网的核心！</font>**

==ARP协议==用于查询同一网络中的<IP地址, MAC地址>之间的映射关系

RARP协议用于将硬件地址转换为IP地址

ICMP协议用于网络层实体之间相互通知“异常事件”

IGMP协议用于实现IP组播



### 2.回顾：以太网MAC帧



<img src="../images/image-20250104165046030.png" alt="image-20250104165046030" style="zoom:50%;" />



<img src="../images/image-20250104165057644.png" alt="image-20250104165057644" style="zoom:50%;" />



### 3.实例



<img src="../images/image-20250104165146933.png" alt="image-20250104165146933" style="zoom: 33%;" />

<img src="../images/image-20250104165203798.png" alt="image-20250104165203798" style="zoom: 33%;" />

<img src="../images/image-20250104165214962.png" alt="image-20250104165214962" style="zoom:33%;" />

<img src="../images/image-20250104165237304.png" alt="image-20250104165237304" style="zoom:33%;" />

### 4.拓展：ARP分组的格式（不会考这么深）



<img src="../images/image-20250104165301645.png" alt="image-20250104165301645" style="zoom:33%;" />



## 九、动态主机配置协议——DHCP



### 知识总览



<img src="../images/image-20250104194716431.png" alt="image-20250104194716431" style="zoom:50%;" />



### 1.各种协议之间的服务关系



<img src="../images/image-20250104194737528.png" alt="image-20250104194737528" style="zoom:33%;" />

<font color='red'>动态主机配置协议</font>（Dynamic Host Configuration Protocol，<font color='red'>DHCP</font>）==常用于给主机动态分配 IP 地址、配置子网掩码、默认网关等网络相关的参数==

<font color='red'>DHCP是应用层协议，使用UDP的提供的服务</font>



### 2.DHCP报文在协议栈中的位置



<img src="../images/image-20250104194829849.png" alt="image-20250104194829849" style="zoom:50%;" />



### 3.回顾：一些特殊用途的IP地址



| 网络号 | 主机号               | 作为分组源地址？ | 作为分组目的地址？ | 代表的含义                                            |
| ------ | -------------------- | ---------------- | ------------------ | ----------------------------------------------------- |
| Y      | 全0                  | ✘                | ✘                  | 表示整个网络本身（只能用于路由表、转发表）            |
| Y      | 全1                  | ✘                | ✔                  | 向网络号为Y的网络广播IP分组                           |
| 0      | Y                    | ✔                | ✘                  | 表示本网络中主机号为Y的主机                           |
| 全0    | 全0                  | ✔                | ✘                  | 本网络上的本主机（会在DHCP协议中使用）                |
| 全1    | 全1                  | ✘                | ✔                  | 向本网络广播IP分组                                    |
| 127    | 非全0或非全1的任何数 | ✔                | ✔                  | 环回自检地址。表示一台主机本身，用于本地 软件环回测试 |

==注意：以上这些特殊地址不能指派给网路中的任何一台主机或路由器“私用”==



> [!IMPORTANT]
>
> <font color='red'>重要结论：</font>前两行说明，如果一个网络中，主机号占 <font color='red'>N </font>bit，那么这个网络中，最多支持<font color='red'>2^N-2</font>台主机&路由器



### 4.最常见的情况：每个网络配置一台DHCP服务器



> 假设 H3 是刚接⼊⽹络的主机，分析DHCP动态配置IP的过程

<img src="../images/image-20250104195049548.png" alt="image-20250104195049548" style="zoom:50%;" />

<img src="../images/image-20250104195130393.png" alt="image-20250104195130393" style="zoom:50%;" />

<img src="../images/image-20250104195144476.png" alt="image-20250104195144476" style="zoom:50%;" />

<img src="../images/image-20250104195154577.png" alt="image-20250104195154577" style="zoom:50%;" />

<img src="../images/image-20250104195205185.png" alt="image-20250104195205185" style="zoom:50%;" />

<img src="../images/image-20250104195215085.png" alt="image-20250104195215085" style="zoom:50%;" />

<img src="../images/image-20250104195227888.png" alt="image-20250104195227888" style="zoom:50%;" />



## 十、IPV6



### 1.IPv6引进的主要变化



#### ①IPv6的诞生背景



<img src="../images/image-20250104214631055.png" alt="image-20250104214631055" style="zoom:50%;" />

- IPv4是在20世纪70年代末期设计的，其<font color='red'>IPv4地址的设计存在以下缺陷：</font>

	- IPv4的设计者最初并没有想到该协议会在全球范围内广泛使用，因此将<font color='red'>IPv4地址的长度</font>规定为他们认为足够长的<font color='red'>32比特</font>。

	- IPv4地址<font color='red'>早期的编址方法</font>（分类的IPv4地址和划分子网的IPv4地址）也<font color='red'>不够合理，造成IPv4地址资源的浪费</font>。

- 因特网经过几十年的飞速发展，到<font color='red'>2011年2月3日</font>，因特网号码分配管理局IANA宣布<font color='red'>IPv4地址</font>已经<font color='red'>分配完毕</font>，因特网服务提供者ISP已经不能再申请到新的IPv4地址块。
	- 我国在2014至2015年也逐步停止向新用户和应用分配IPv4地址，同时全面开展商用部署IPv6。

- 如果<font color='red'>没有网络地址转换NAT</font>技术的广泛应用，IPv4早已停止发展。
- 然而，NAT仅仅是为了延长IPv4使用寿命而采取的权宜之计，<font color='red'>解决IPv4地址耗尽的根本措施就是采用具有更大地址空间（IP地址的长度为128比特）的新版本IP，即IPv6。</font>
- 因特网工程任务组IETF早在1992年6月就提出要制定下一代的IP，即IPng（IP Next Generation）。IPng现在正式称为IPv6。
- <font color='red'>直接将因特网的核心协议从IPv4更换成IPv6是不可行的。</font>
	- 世界上许多团体都从因特网的发展中看到了机遇，因此在IPv6标准的制定过程中<font color='red'>出于自身经济利益</font>而产生了激烈的争论。
- 到目前为止，IPv6还只是<font color='red'>草案标准</font>阶段[RFC 2460，RFC 4862，RFC 4443]。



尽早开始过渡到IPv6有以下好处：

1. 有更多时间来平滑过渡
2. 有更多时间来培养IPv6的专门人才
3. 及早提供IPv6服务比较便宜



#### ②IPv6引进的主要变化



**更大的地址空间**

IPv6将IPv4的<font color='red'>32比特</font>地址空间增大到了<font color='red'>128比特</font>，在采用合理编址方法的情况下，在可预见的未来是不会用完的。

**扩展的地址层次结构**

可划分为更多的层次，这样可以更好地反映出因特网的拓扑结构，使得<font color='red'>对寻址和路由层次的设计更具有灵活性</font>。

**灵活的首部格式**

与IPv4首部并不兼容。IPv6定义了许多<font color='red'>可选的的扩展首部</font>，不仅可提供比IPv4更多的功能，而且还可以<font color='red'>提高路由器的处理效率</font>，因为路由器对逐跳扩展首部外的其他扩展首部都不进行处理。

**改进的选项**

IPv6允许分组<font color='red'>包含有选项的控制信息</font>，因而<font color='red'>可以包含一些新的选项</font>。然而IPv4规定的选项却是固定不变的

**允许协议继续扩充**

<font color='red'>这一点很重要，因为技术总是在不断地发展，而新的应用也会层出不穷。然而IPv4的功能却是固定不变的。</font>

**支持即插即用（即自动配置）**

IPv6支持主机或路由器自动配置IPv6地址及其他网络配置参数。因此<font color='red'>IPv6不需要使用DHCP</font>。

**支持资源的预分配**

IPv6能为实时音视频等要求保证一定带宽和时延的应用，提供<font color='red'>更好的服务质量保证</font>。



### 2.IPv6数据报的首部



#### ①IPv6数据报的基本首部

<img src="../images/image-20250104215442460.png" alt="image-20250104215442460" style="zoom:50%;" />

<img src="../images/image-20250104215459437.png" alt="image-20250104215459437" style="zoom:50%;" />



<img src="../images/image-20250104215909925.png" alt="image-20250104215909925" style="zoom:33%;" />

**版本字段**：长度为4比特，用来表示IP协议的版本。对于IPv6该字段的值是6。



<img src="../images/image-20250104215940818.png" alt="image-20250104215940818" style="zoom:33%;" />

**通信量类字段：**长度为8比特，该字段用来<font color='red'>区分同的IPv6数据报的类别或优先级</font>。目前正在进行不同的通信量类性能的实验

<img src="../images/image-20250104220051759.png" alt="image-20250104220051759" style="zoom:33%;" />

**流标号字段：**长度为20比特。

- IPv6提出了<font color='red'>流</font>的抽象概念。
- <font color='red'>“流”就是因特网上从特定源点到特定终点（单播或多播）的一系列IPv6数据报（如实时音视频数据的传送），而在这个“流”所经过的路径上的所有路由器都保证指明的服务质量。</font>
- 所有属于同一个流的IPv6数据报都具有同样的流标号。换句话说，<font color='red'>流标号用于资源分配。</font>
- 流标号对于实时音视频数据的传送特别有用，但对于传统的非实时数据，流标号则没有用处，把流标号字段的值置为0即可。



<img src="../images/image-20250104220153052.png" alt="image-20250104220153052" style="zoom:33%;" />

**有效载荷长度字段**：长度为16比特，它<font color='red'>指明IPv6数据报基本首部后面的有效载荷（包括扩展首部和数据部分）的字节数量。</font>

- 该字段以字节为单位，最大取值为65535，因此IPv6数据报基本首部后面的有效载荷的最大长度为65535字节。

<img src="../images/image-20250104220230019.png" alt="image-20250104220230019" style="zoom:33%;" />

**下一个首部字段：**长度为8比特。该字段相当于IPv4数据报首部中的<font color='red'>协议字段或可选字段</font>。

- <font color='red'>当IPv6数据报没有扩展首部时</font>，该字段的作用与IPv4的协议字段一样，它的值指出了IPv6数据报基本首部后面的数据是何种协议数据单元PDU。<img src="../images/image-20250104220511354.png" alt="image-20250104220511354" style="zoom:25%;" />
- <font color='red'>当IPv6数据报基本首部后面带有扩展首部时</font>，该字段的值就标识后面第一个扩展首部的类型。<img src="../images/image-20250104220536404.png" alt="image-20250104220536404" style="zoom:25%;" />

<img src="../images/image-20250104220626173.png" alt="image-20250104220626173" style="zoom: 33%;" />

<img src="../images/image-20250104220640688.png" alt="image-20250104220640688" style="zoom:33%;" />

**跳数限制字段**：长度为8比特。该字段用来<font color='red'>防止IPv6数据报在因特网中永久兜圈</font>。

- 源点在每个IPv6数据报发出时即设定某个跳数限制（最大255跳）。
- 每个路由器在转发IPv6数据报时，要先把跳数限制字段中的值减1。当跳数限制的值为0时，就把这个IPv6数据报丢弃（即不转发）。

该字段的作用与IPv4数据报首部中的生存时间TTL字段完全一样。IPv6将名称改为跳数限制后，可使名称与作用更加一致。



<img src="../images/image-20250104220757257.png" alt="image-20250104220757257" style="zoom:33%;" />

**源地址字段和目的地址字段**：长度都为128比特。分别用来填写IPv6数据报的发送端的IPv6地址和接收端的IPv6地址。



**<font color='red'>与IPV4的对比</font>**

<img src="../images/image-20250104215527989.png" alt="image-20250104215527989" style="zoom:50%;" />

- IPv6将IPv4数据报首部中不必要的功能取消了，这使得<font color='red'>IPv6数据报基本首部中的字段数量减少到只有8个</font>。
- 但由于IPv6地址的长度扩展到了128比特，因此使得<font color='red'>IPv6数据报基本首部的长度反而增大到了40字节</font>，比IPv4数据报首部固定部分的长度（20字节）增大了20字节

<img src="../images/image-20250104215653559.png" alt="image-20250104215653559" style="zoom:33%;" />

<img src="../images/image-20250104215705819.png" alt="image-20250104215705819" style="zoom:33%;" />

<img src="../images/image-20250104215715873.png" alt="image-20250104215715873" style="zoom:33%;" />

<img src="../images/image-20250104215726923.png" alt="image-20250104215726923" style="zoom:33%;" />

<img src="../images/image-20250104215737429.png" alt="image-20250104215737429" style="zoom:33%;" />

<img src="../images/image-20250104215748750.png" alt="image-20250104215748750" style="zoom:33%;" />

<img src="../images/image-20250104215809786.png" alt="image-20250104215809786" style="zoom:33%;" />

<img src="../images/image-20250104215818653.png" alt="image-20250104215818653" style="zoom:33%;" />



#### ②IPv6数据报的扩展首部



- <font color='red'>IPv4数据报</font>如果在其首部中<font color='red'>使用了选项字段</font>，则在数据报的整个传送路径中的全部路由器，都要对选项字段进行检查，这就<font color='red'>降低了路由器处理数据报的速度</font>。
- 实际上，在路径中的路由器对很多选项是不需要检查的。因此，<font color='red'>为了提高路由器对数据包的处理效率</font>，<font color='red'>IPv6把原来IPv4首部中的选项字段都放在了扩展首部中</font>，由路径两端的源点和终点的主机来处理，而数<font color='red'>据报传送路径中的所有路由器都不处理这些扩展首部（除逐跳选项扩展首部）。</font>



**在[RFC 2460]中定义了以下六种扩展首部：**

（1） 逐跳选项
（2） 路由选择
（3） 分片
（4） 鉴别
（5） 封装安全有效载荷
（6） 目的站选项

- <font color='red'>每一个扩展首部都由若干个字段组成</font>，它们的长度也各不相同。
- <font color='red'>所有扩展首部中的第一个字段都是8比特的下一个首部字段</font>。该字段的值指出在该扩展首部后面是何种扩展首部。
- 当使用多个扩展首部时，<font color='red'>应按以上的先后顺序出现</font>。



### 3.IPv6地址



#### ①IPv6地址空间大小



在IPv6中，每个地址占<font color='red'>128个比特。</font>

<img src="../images/image-20250104221530761.png" alt="image-20250104221530761" style="zoom:33%;" />

很显然，这样巨大的地址空间在采用合理编址方法的情况下，在可预见的未来是不会用完的。



#### ②IPv6地址的表示方法



<img src="../images/image-20250104221617560.png" alt="image-20250104221617560" style="zoom:50%;" />

在IPv6地址的冒号十六进制记法的基础上，再使用“<font color='red'>左侧零”省略</font>和<font color='red'>“连续零”压缩</font>，可使IPv6地址的表示更加简洁。

- “左侧零”省略是指两个冒号间的十六进制数中最前面的一串0可以省略不写。
-  “连续零”压缩是指一连串连续的0可以用一对冒号取代。

【举例】

<img src="../images/image-20250104221727684.png" alt="image-20250104221727684" style="zoom: 33%;" />



- <font color='red'>在一个IPv6地址中只能使用一次“连续零”压缩，</font>font>否则会导致歧义。

【举例】

<img src="../images/image-20250104221838258.png" alt="image-20250104221838258" style="zoom: 33%;" />

<img src="../images/image-20250104221858310.png" alt="image-20250104221858310" style="zoom:33%;" />

- <font color='red'>冒号十六进制记法还可结合点分十进制的后缀</font>font>。这在IPv4向IPv6过渡阶段非常有用。

<img src="../images/image-20250104221937635.png" alt="image-20250104221937635" style="zoom:33%;" />

- CIDR的斜线表示法在IPv6中仍然可用。

<img src="../images/image-20250104221958396.png" alt="image-20250104221958396" style="zoom:33%;" />



#### ③IPv6地址的分类



**IPv6数据报的目的地址有三种基本类型：**



- 单 播（unicast）:传统的点对点通信
- 多 播（multicast）:一点对多点的通信。数据报发送到一组计算机中的每一个。IPv6没有采用广播的术语，而将广播看作多播的一个特例。
- 任 播（anycast）:这是IPv6新增的一种类型。任播的<font color='red'>终点是一组计算机，但数据报只交付其中的一个</font>，通常是按照路由算法得出的距离最近的一个。



**[RFC 4291]对IPv6地址进行了分类：**



<img src="../images/image-20250104222123001.png" alt="image-20250104222123001" style="zoom:50%;" />

<img src="../images/image-20250104222140325.png" alt="image-20250104222140325" style="zoom:33%;" /><img src="../images/image-20250104222147547.png" alt="image-20250104222147547" style="zoom:33%;" /><img src="../images/image-20250104222247295.png" alt="image-20250104222247295" style="zoom:33%;" /><img src="../images/image-20250104222258945.png" alt="image-20250104222258945" style="zoom:33%;" /><img src="../images/image-20250104222308086.png" alt="image-20250104222308086" style="zoom:33%;" />



### 4.从IPv4向IPv6过渡



#### ①从IPv4向IPv6过渡



- 因特网上使用IPv4的路由器的数量太大，要让所有路由器都改用IPv6并不能一蹴而就。因此，<font color='red'>从IPv4转变到IPv6只能采用逐步演进的</font>办法。

- 另外，<font color='red'>新部署的IPv6系统必须能够向后兼容</font>，也就是IPv6系统必须能够接收和转发IPv4数据报，并且能够为IPv4数据报选择路由。

- 下面介绍两种由IPv4向IPv6过渡的策略：

	- 使用双协议栈

	- 使用隧道技术

	

#### ②使用双协议栈

- 双协议栈（Dual Stack）是指在完全过渡到IPv6之前，使一部分主机或路由器<font color='red'>装有IPv4和IPv6两套协议栈。</font>
- 双协议栈主机或路由器<font color='red'>既可以和IPv6系统通信，又可以和IPv4系统通信。</font>
- 双协议栈主机或路由器记为IPv6/IPv4，表明它<font color='red'>具有一个IPv6地址和一个IPv4地址。</font>
	- 双协议栈主机在与IPv6主机通信时采用IPv6地址，而与IPv4主机通信时采用IPv4地址。
	- 双协议栈主机通过域名系统DNS查询目的主机采用的IP地址：
		- 若DNS返回的是IPv4地址，则双协议栈的源主机就使用IPv4地址；
		- 若DNS返回的是IPv6地址，则双协议栈的源主机就使用IPv6地址。

<img src="../images/image-20250104222615594.png" alt="image-20250104222615594" style="zoom: 33%;" />





#### ③使用隧道技术



隧道技术（Tunneling）的核心思想是：

- 当IPv6数据报要进入IPv4网络时，将IPv6数据报重新封装成IPv4数据报，即整个IPv6数据报成为IPv4数据报的数据载荷。
- 封装有IPv6数据报的IPv4数据报在IPv4网络中传输。
- 当IPv4数据报要离开IPv4网络时，再将其数据载荷（即原来的IPv6数据报）取出并转发到IPv6网络。

<img src="../images/image-20250104222656606.png" alt="image-20250104222656606" style="zoom:33%;" />

<img src="../images/image-20250104222725411.png" alt="image-20250104222725411" style="zoom:33%;" />



## 十一、路由信息协议——RIP



### 1.路由信息协议RIP的相关基本概念



- 路由信息协议（<font color='red'>R</font>outing <font color='red'>I</font>nformation <font color='red'>P</font>rotocol，<font color='red'>RIP</font>）是内部网关协议中最先得到广泛使用的协议之一，其相关标准文档为[RFC 1058]。
- RIP要求自治系统AS内的每一个路由器，都要维护从它自己到AS内其他每一个网络的距离记录。这是一组距离，称为<font color='red'>距离向量</font>（<font color='red'>D</font>istance-<font color='red'>V</font>ector，<font color='red'>D-V</font>）。
- RIP使用<font color='red'>跳数</font>（Hop Count）作为度量（Metric）来衡量到达目的网络的<font color='red'>距离</font>。
	- RIP将路由器<font color='red'>到直连网络</font>的<font color='red'>距离定义为1</font>。
	- RIP将路由器<font color='red'>到非直连网络</font>的<font color='red'>距离定义为所经过的路由器数加1</font>。
	- RIP允许一条路径最多只能包含15个路由器，<font color='red'>距离等于16时相当于不可达</font>。因此<font color='red'>RIP只适用于小型互联网</font>。



> [!CAUTION]
>
> 有些厂商的路由器并没有严格按照RIP标准文档的规定来实现RIP。例如，思科路由器中的RIP，将路由器到直连网络的距离定义为0，但这并不影响RIP的正常运行。

<img src="../images/image-20250105101535509.png" alt="image-20250105101535509" style="zoom:33%;" />



- RIP认为<font color='red'>好的路由</font>就是“距离短”的路由，也就是所<font color='red'>通过路由器数量最少的路由</font>。

<img src="../images/image-20250105101608285.png" alt="image-20250105101608285" style="zoom:33%;" />

- 当到达同一目的网络有多条RIP距离相等的路由时，可以进行<font color='red'>等价负载均衡</font>，也就是将通信量均衡地分布到多条等价的路径上。

<img src="../images/image-20250105101628864.png" alt="image-20250105101628864" style="zoom:33%;" />



- RIP具有以下三个重要特点：
	- **和谁交换信息**：仅和<font color='red'>相邻路由器</font>交换信息。<img src="../images/image-20250105101752574.png" alt="image-20250105101752574" style="zoom:33%;" />
	- **交换什么信息**：路由器自己的<font color='red'>路由表</font>。即本路由器到所在自治系统AS中各网络的最短RIP距离，以及到各网络应经过的下一跳路由器。
	- **何时交换信息**：<font color='red'>周期性交换</font>（例如，每个约30秒）。为了加快RIP的收敛速度，当网络拓扑发生变化时，路由器要及时向相邻路由器通告拓扑变化后的路由信息，这称为触发更新



### 2.RIP的基本工作过程



<img src="../images/image-20250105101917139.png" alt="image-20250105101917139" style="zoom:33%;" />

<img src="../images/image-20250105102000936.png" alt="image-20250105102000936" style="zoom:33%;" />

<img src="../images/image-20250105102014875.png" alt="image-20250105102014875" style="zoom:33%;" />



1. 路由器刚开始工作时，<font color='red'>只知道自己到直连网络的RIP距离为1</font>。
2. 每个路由器<font color='red'>仅和相邻路由器周期性地交换并更新路由信息</font>。
3. 若干次交换和更新后，<font color='red'>每个路由器都知道到达本自治系统AS内各网络的最短距离和下一跳路由器</font>，称为<font color='red'>收敛</font>。



### 3. RIP的距离向量算法



<img src="../images/image-20250105102106907.png" alt="image-20250105102106907" style="zoom:33%;" />

<img src="../images/image-20250105102120039.png" alt="image-20250105102120039" style="zoom:33%;" />

<img src="../images/image-20250105102129651.png" alt="image-20250105102129651" style="zoom:33%;" />

<img src="../images/image-20250105102139934.png" alt="image-20250105102139934" style="zoom:33%;" />

<img src="../images/image-20250105102159183.png" alt="image-20250105102159183" style="zoom:33%;" />

<img src="../images/image-20250105102212047.png" alt="image-20250105102212047" style="zoom:33%;" />

<img src="../images/image-20250105102229802.png" alt="image-20250105102229802" style="zoom: 33%;" />

<img src="../images/image-20250105102242648.png" alt="image-20250105102242648" style="zoom:33%;" />

**更新理由：到达目的网络，<font color='red'>相同的下一跳</font>，<font color='red'>最新消息</font>，要更新**

<img src="../images/image-20250105102340489.png" alt="image-20250105102340489" style="zoom:33%;" />

<img src="../images/image-20250105102350828.png" alt="image-20250105102350828" style="zoom:33%;" />

**更新理由：发现了新的网络，添加**

<img src="../images/image-20250105102420400.png" alt="image-20250105102420400" style="zoom:33%;" />

**更新理由：到达目的网络，<font color='red'>不同的下一跳</font>，<font color='red'>新路由优势</font>，要更新**

<img src="../images/image-20250105102515463.png" alt="image-20250105102515463" style="zoom:33%;" />

<img src="../images/image-20250105102527015.png" alt="image-20250105102527015" style="zoom:33%;" />

**更新理由：到达目的网络，<font color='red'>不同的下一跳</font>，<font color='red'>RIP距离相等，可以等价负载均衡</font>，添加**

<img src="../images/image-20250105102618345.png" alt="image-20250105102618345" style="zoom:33%;" />

**不更新理由：到达目的网络，<font color='red'>不同的下一跳</font>，<font color='red'>新路由劣势</font>，不更新**



- 除了上述RIP路由条目更新规则，在RIP的距离向量算法中还包含以下一些<font color='red'>时间参数</font>：
	- 路由器每隔<font color='red'>大约30秒</font>向其所有相邻路由器发送路由更新报文。
	- 若<font color='red'>180秒</font>（默认）没有收到某条路由条目的更新报文，则把该路由条目标记为无效（即把RIP距离设置为16，表示不可达），若再过一段时间（如120秒），还没有收到该路由条目的更新报文，则将该路由条目从路由表中删除。

**例**

<img src="../images/image-20250105102734431.png" alt="image-20250105102734431" style="zoom:33%;" />

<img src="../images/image-20250105102806582.png" alt="image-20250105102806582" style="zoom:33%;" />



### **4.RIP存在的问题**



> ——“坏消息传播得慢



<img src="../images/image-20250105102830280.png" alt="image-20250105102830280" style="zoom:33%;" />

<img src="../images/image-20250105102841082.png" alt="image-20250105102841082" style="zoom:33%;" />

<img src="../images/image-20250105102850335.png" alt="image-20250105102850335" style="zoom:33%;" />

<img src="../images/image-20250105102901587.png" alt="image-20250105102901587" style="zoom:33%;" />

- “坏消息传播得慢”的问题又被称为路由环路或<font color='red'>RIP距离无穷计数问题</font>。这是距离向量算法的一个固有问题。可以采取以下多种措施减少出现该问题的概率或<font color='red'>减小</font>该问题带来的危害：
	- 限制<font color='red'>最大RIP距离为15</font>（16表示不可达）。
	- 当路由表发生变化时就立即发送路由更新报文（即“<font color='red'>触发更新</font>”），而不仅是周期性发送。
	- 让路由器记录收到某个特定路由信息的接口，而不让同一路由信息再通过此接口向反方向传送（即“<font color='red'>水平分割</font>”）。

> [!CAUTION]
> 使用上述措施仍无法彻底解决问题。因为在距离向量算法中，每个路由器都缺少到目的网络整个路径的完整信息，无法判断所选的路由是否出现了环路



### 5.RIP版本和相关报文的封装



- 现在较新的RIP版本是1998年11月公布的<font color='red'>RIP2</font>[RFC 2453]，已经成为因特网标准协议。与RIP1相比，RIP2可以支持<font color='red'>变长子网掩码和CIDR</font>。另外，RIP2还提供<font color='red'>简单的鉴别过程</font>并支持<font color='red'>多播</font>。
- RIP相关报文使用运输层的用户数据报协议UDP进行封装，使用的<font color='red'>UDP端口号为520</font>。
	- 从<font color='red'>RIP报文封装</font>的角度看，RIP属于TCP/IP体系结构的<font color='red'>应用层</font>。
	- 但RIP的核心功能是<font color='red'>路由选择</font>，这属于TCP/IP体系结构的<font color='red'>网际层</font>。



### 6.RIP的优缺点



<img src="../images/image-20250105103159277.png" alt="image-20250105103159277" style="zoom:33%;" />



## 十二、开放最短路径优先协议——OSPF



### 1.OSPF的相关基本概念



<img src="../images/image-20250105150556808.png" alt="image-20250105150556808" style="zoom:33%;" />

<img src="../images/image-20250105150607449.png" alt="image-20250105150607449" style="zoom:33%;" />

<img src="../images/image-20250105150622543.png" alt="image-20250105150622543" style="zoom:33%;" />

<img src="../images/image-20250105150637556.png" alt="image-20250105150637556" style="zoom:33%;" />

<img src="../images/image-20250105150658592.png" alt="image-20250105150658592" style="zoom:33%;" />

<img src="../images/image-20250105150708861.png" alt="image-20250105150708861" style="zoom:33%;" />

<img src="../images/image-20250105150718714.png" alt="image-20250105150718714" style="zoom:33%;" />

<img src="../images/image-20250105150731252.png" alt="image-20250105150731252" style="zoom:33%;" />

<img src="../images/image-20250105150744909.png" alt="image-20250105150744909" style="zoom:33%;" />

<img src="../images/image-20250105150804632.png" alt="image-20250105150804632" style="zoom:33%;" />

<img src="../images/image-20250105150826442.png" alt="image-20250105150826442" style="zoom:33%;" />

<img src="../images/image-20250105150842327.png" alt="image-20250105150842327" style="zoom:33%;" />

<img src="../images/image-20250105150852425.png" alt="image-20250105150852425" style="zoom:33%;" />



### 2.OSPF的五种分组类型



<img src="../images/image-20250105150905679.png" alt="image-20250105150905679" style="zoom:33%;" />



### 3.OSPF的基本工作过程



<img src="../images/image-20250105150918381.png" alt="image-20250105150918381" style="zoom:33%;" />



### 4.多点接入网络中的OSPF路由器



<img src="../images/image-20250105150930297.png" alt="image-20250105150930297" style="zoom:33%;" />

<img src="../images/image-20250105150946860.png" alt="image-20250105150946860" style="zoom:33%;" />

<img src="../images/image-20250105150958315.png" alt="image-20250105150958315" style="zoom: 33%;" />

<img src="../images/image-20250105151015813.png" alt="image-20250105151015813" style="zoom:33%;" />



### 5.OSPF划分区域



<img src="../images/image-20250105151035516.png" alt="image-20250105151035516" style="zoom:33%;" />

<img src="../images/image-20250105151049661.png" alt="image-20250105151049661" style="zoom:33%;" />

<img src="../images/image-20250105151059273.png" alt="image-20250105151059273" style="zoom:33%;" />

<img src="../images/image-20250105151119325.png" alt="image-20250105151119325" style="zoom:33%;" />

<img src="../images/image-20250105151129057.png" alt="image-20250105151129057" style="zoom:33%;" />

<img src="../images/image-20250105151138658.png" alt="image-20250105151138658" style="zoom:33%;" />



<img src="../images/image-20250105151150309.png" alt="image-20250105151150309" style="zoom:33%;" />

<img src="../images/image-20250105151206866.png" alt="image-20250105151206866" style="zoom:33%;" />



## 十三、边界网关协议——BGP



### 1.BGP的相关基本概念

<img src="../images/image-20250105151312773.png" alt="image-20250105151312773" style="zoom:33%;" />

<img src="../images/image-20250105151322733.png" alt="image-20250105151322733" style="zoom:33%;" />

<img src="../images/image-20250105151336322.png" alt="image-20250105151336322" style="zoom:33%;" />

<img src="../images/image-20250105151345197.png" alt="image-20250105151345197" style="zoom:33%;" />

<img src="../images/image-20250105151355715.png" alt="image-20250105151355715" style="zoom:33%;" />

<img src="../images/image-20250105151408482.png" alt="image-20250105151408482" style="zoom:33%;" />

<img src="../images/image-20250105151421471.png" alt="image-20250105151421471" style="zoom:33%;" />

<img src="../images/image-20250105151454060.png" alt="image-20250105151454060" style="zoom:33%;" />

<img src="../images/image-20250105151506265.png" alt="image-20250105151506265" style="zoom:33%;" />

<img src="../images/image-20250105151518414.png" alt="image-20250105151518414" style="zoom:33%;" />

<img src="../images/image-20250105151530113.png" alt="image-20250105151530113" style="zoom:33%;" />

<img src="../images/image-20250105151541244.png" alt="image-20250105151541244" style="zoom:33%;" />

<img src="../images/image-20250105151553414.png" alt="image-20250105151553414" style="zoom:33%;" />

<img src="../images/image-20250105151603493.png" alt="image-20250105151603493" style="zoom:33%;" />



### 2.BGP-4的四种报文



<img src="../images/image-20250105151617258.png" alt="image-20250105151617258" style="zoom:33%;" />

<img src="../images/image-20250105151634006.png" alt="image-20250105151634006" style="zoom:33%;" />

<img src="../images/image-20250105151703938.png" alt="image-20250105151703938" style="zoom:33%;" />



## 十四、IP多播



### 1.IP多播技术的相关基本概念



<img src="../images/image-20250105151854922.png" alt="image-20250105151854922" style="zoom:33%;" />

<img src="../images/image-20250105151932473.png" alt="image-20250105151932473" style="zoom:33%;" />

<img src="../images/image-20250105151950292.png" alt="image-20250105151950292" style="zoom:33%;" />

<img src="../images/image-20250105152003155.png" alt="image-20250105152003155" style="zoom:33%;" />

<img src="../images/image-20250105152013674.png" alt="image-20250105152013674" style="zoom:33%;" />

<img src="../images/image-20250105152023188.png" alt="image-20250105152023188" style="zoom:33%;" />



### 2.IP多播地址和多播组



<img src="../images/image-20250105152036273.png" alt="image-20250105152036273" style="zoom:33%;" />

## 十五、在局域网上进行硬件多播



<img src="../images/image-20250105152106229.png" alt="image-20250105152106229" style="zoom:33%;" />

<img src="../images/image-20250105152132283.png" alt="image-20250105152132283" style="zoom:33%;" />

<img src="../images/image-20250105152146878.png" alt="image-20250105152146878" style="zoom:33%;" />

<img src="../images/image-20250105152200906.png" alt="image-20250105152200906" style="zoom:33%;" />

<img src="../images/image-20250105152213364.png" alt="image-20250105152213364" style="zoom:33%;" />



<img src="../images/image-20250105152226596.png" alt="image-20250105152226596" style="zoom:33%;" />

<img src="../images/image-20250105152237003.png" alt="image-20250105152237003" style="zoom:33%;" />

<img src="../images/image-20250105152258893.png" alt="image-20250105152258893" style="zoom:33%;" />

<img src="../images/image-20250105152310456.png" alt="image-20250105152310456" style="zoom:33%;" />

<img src="../images/image-20250105152320623.png" alt="image-20250105152320623" style="zoom:33%;" />

<img src="../images/image-20250105152333297.png" alt="image-20250105152333297" style="zoom:33%;" />

<img src="../images/image-20250105152344968.png" alt="image-20250105152344968" style="zoom:33%;" />



## 十六、在因特网上进行IP多播需要的两种协议



<img src="../images/image-20250105152504189.png" alt="image-20250105152504189" style="zoom:33%;" />



###  1.网际组管理协议IGMP



<img src="../images/image-20250105152541108.png" alt="image-20250105152541108" style="zoom:33%;" />



### 2.多播路由选择协议



<img src="../images/image-20250105152742846.png" alt="image-20250105152742846" style="zoom:33%;" />

<img src="../images/image-20250105152754410.png" alt="image-20250105152754410" style="zoom:33%;" />

<img src="../images/image-20250105152804339.png" alt="image-20250105152804339" style="zoom:33%;" />

<img src="../images/image-20250105152814624.png" alt="image-20250105152814624" style="zoom:33%;" />

<img src="../images/image-20250105152827712.png" alt="image-20250105152827712" style="zoom:33%;" />



## 十七、移动IP



<img src="../images/image-20250105152941623.png" alt="image-20250105152941623" style="zoom:33%;" />

<img src="../images/image-20250105152951308.png" alt="image-20250105152951308" style="zoom:33%;" />

<img src="../images/image-20250105153000572.png" alt="image-20250105153000572" style="zoom:33%;" />



# 第五章 传输层



## 一、传输层提供的服务



### 知识总览



<img src="../images/image-20250105163256767.png" alt="image-20250105163256767" style="zoom:50%;" />



### 1.传输层在协议栈中的位置



<img src="../images/image-20250105163324040.png" alt="image-20250105163324040" style="zoom: 33%;" />



### 2.传输层“端口号”的概念



<img src="../images/image-20250105163348292.png" alt="image-20250105163348292" style="zoom:33%;" />

<font color='blue'>网络层</font>实现了“<u>主机到主机</u>”的通信。网络层在IP数据报的首部，指明<font color='blue'>源IP地址、目的IP地址</font>

<font color='red'>传输层</font>实现了“<u>端到端</u>”（<u>进程到进程</u>）的通信。传输层在 TCP(或UDP)报文段的首部，指明<font color='red'>源端口、目的端口</font>



### 3.进程、端口号、传输层协议之间的关系



假设：进程1、5正在用TCP通信；2、6正在用TCP通信；3、7正在用UDP通信；4、8正在用UDP通信

<img src="../images/image-20250105163631678.png" alt="image-20250105163631678" style="zoom:50%;" />

<font color='red'>注意：</font>

- <font color='red'>两台主机的端口号是相互独立的</font>
- ==TCP、UDP的端口号也是相互独立的==
- 当两个进程之间想要通信时，需要指明：
	- ①使用哪种传输层协议；
	- ②本进程绑定的端口号；
	- ③对方的IP地址和端口号；

<font color='red'>套接字（Socket）= (IP 地址: 端口号)</font>

> 分为TCP套接字、UDP套接字



### 4.熟知端口号



<img src="../images/image-20250105163827058.png" alt="image-20250105163827058" style="zoom:33%;" />

0~1023为熟知端口号，开发的时候一般不使用

其他端口号在实际开发时并没有特别严格的限制，只要在本机没有被使用的端口号都可以使用

<font color='red'>端口号分类只是一种“建议标准”，而非“强制标准”</font>



### 5.有连接的传输 vs 无连接的传输



<img src="../images/image-20250105163906804.png" alt="image-20250105163906804" style="zoom:33%;" />



### 6.可靠的传输 vs 不可靠的传输



<img src="../images/image-20250105163923221.png" alt="image-20250105163923221" style="zoom:33%;" />





## 二、UDP数据报



### 知识总览



<img src="../images/image-20250105164238074.png" alt="image-20250105164238074" style="zoom:33%;" />



### 1.UDP协议、UDP数据报、UDP首部



<img src="../images/image-20250105164032048.png" alt="image-20250105164032048" style="zoom:50%;" />

- UDP首部很小，只占8B
- UDP每次传输一个完整的报文，不支持报文自动拆分、重装
- UDP是无连接的、不可靠的（可靠性可以交给应用层处理），也不支持拥塞控制
- UDP支持一对一（封装成单播IP数据报）、一对多传输（封装成广播/多播IP数据报）



### 2.TCP协议、TCP报文段、TCP首部



<img src="../images/image-20250105164109436.png" alt="image-20250105164109436" style="zoom:50%;" />

- TCP首部更大，占20~60B
- TCP支持报文自动拆分、重装，因此可以传输长报文
- TCP是有连接的、可靠的、支持拥塞控制
- TCP仅支持一对一传输（因为通信双方的传输层必须先建立连接）



### 3.UDP数据报格式



<img src="../images/image-20250105164140189.png" alt="image-20250105164140189" style="zoom:50%;" />

### 4.UDP数据报示例



<img src="../images/image-20250105164202164.png" alt="image-20250105164202164" style="zoom:50%;" />



### 5.IP数据报（IP分组）的格式



<img src="../images/image-20250105164308393.png" alt="image-20250105164308393" style="zoom:50%;" />



## 三、UDP检验



### 知识总览



<img src="../images/image-20250105164605359.png" alt="image-20250105164605359" style="zoom:33%;" />



### 1.一种新的差错检验方法



<img src="../images/image-20250105164359547.png" alt="image-20250105164359547" style="zoom:50%;" />

<img src="../images/image-20250105164409155.png" alt="image-20250105164409155" style="zoom:50%;" />



### 2.UDP检验（发送方的传输层）



<img src="../images/image-20250105164430111.png" alt="image-20250105164430111" style="zoom:50%;" />

①传输层的UDP协议在计算检验和之前，先添加伪首部
②把伪首部、首部、数据部分以16bit为一组，进行二进制加法（最高位产生的进位需要回卷）
③将最终的加法结果逐位取反，就得到16bit检验和，将其填入UDP首部
④去掉伪首部，并将UDP数据报交给网络层，封装成IP数据报



### 3.UDP检验（接收方的传输层）



<img src="../images/image-20250105164456562.png" alt="image-20250105164456562" style="zoom:50%;" />

①网络层向传输层递交UDP数据报
②传输层在UDP数据报之前，添加伪首部
③把伪首部、UDP首部、数据部分以16bit为一组，进行二进制加法（最高位产生的进位需要回卷）
④如果加法结果为全1，说明没有比特错误，于是接收该UDP数据报，并根据目的端口号，向应用层递交报文。如果加法结果不是全1，说明有差错，于是丢弃该UDP数据报



### 4.例题



![image-20250105164530270](../images/image-20250105164530270.png)

C



## 四、TCP报文段（TCP段）



### 知识总览



<img src="../images/image-20250105205134215.png" alt="image-20250105205134215" style="zoom:50%;" />



### 1.TCP报文段（ 另译“TCP段”）



> TCP segment——TCP段



<img src="../images/image-20250105205220882.png" alt="image-20250105205220882" style="zoom:50%;" />



### 2.建立一次TCP连接可以传输多个报文



<img src="../images/image-20250105205253836.png" alt="image-20250105205253836" style="zoom:50%;" />



<font color='red'>MSS（ Maximum Segment Size，最大段长）</font>



### 3.TCP段格式



<img src="../images/image-20250105205340278.png" alt="image-20250105205340278" style="zoom:50%;" />

#### ①源端口、目的端口

<img src="../images/image-20250105205354757.png" alt="image-20250105205354757" style="zoom: 33%;" />

#### ②序号(seq)、确认号(ack或ack_seq)、ACK

> [!IMPORTANT]
>
> <img src="../images/image-20250105205417058.png" alt="image-20250105205417058" style="zoom: 33%;" />

**“序号”字段示例**

<img src="../images/image-20250105205510771.png" alt="image-20250105205510771" style="zoom:33%;" />

**确认号（ACK、ack_seq）示例**

<img src="../images/image-20250105205546835.png" alt="image-20250105205546835" style="zoom: 33%;" />

<font color='red'>TCP协议的三大阶段：</font>

- 建立连接（三次握手）
- 数据传输
- 释放连接（四次挥手）

#### ③数据偏移、保留

<img src="../images/image-20250105205917874.png" alt="image-20250105205917874" style="zoom: 33%;" />

> [!CAUTION]
>
> 注1：Data Offset “数据偏移”这个翻译有迷惑性，容易误解
> 注2：在TCP首部中，并不会专门记录TCP数据部分长度（会根据IP首部、TCP首部的信息算出来）

#### ④URG、PSH、RST、紧急指针

<img src="../images/image-20250105210111674.png" alt="image-20250105210111674" style="zoom:33%;" />

- URG：紧急位（Urgent）
- PSH：推送位（Push）
- RST：复位位（Reset）

**URG、紧急指针示例**

<img src="../images/image-20250105210156193.png" alt="image-20250105210156193" style="zoom:33%;" />

#### ⑤SYN、FIN

> [!IMPORTANT]
>
> <img src="../images/image-20250105210251409.png" alt="image-20250105210251409" style="zoom:33%;" />
>
> <font color='red'>SYN</font>：同步位
> <font color='red'>FIN</font>：终止位（Finish）

> [!CAUTION]
>
> **注意：**
> **只有<font color='red'>握手①</font>、<font color='red'>握手②</font>的<font color='red'>SYN=1</font>，其他所有TCP报文段都是SYN=0**
> **只有<font color='red'>挥手①</font>、<font color='red'>挥手③</font>的<font color='red'>FIN=1</font>，其他所有TCP报文段都是FIN=0**



考题常见术语补充：

- 若<font color='red'>SYN=1</font>，可称为<font color='red'>SYN段</font>
- 若<font color='red'>FIN=1</font>，可称为<font color='red'>FIN段</font>
- 若<font color='red'>ACK=1</font>，可称为<font color='red'>ACK段</font>
- 其他标志位同理



**SYN、FIN示例**

<img src="../images/image-20250105210615930.png" alt="image-20250105210615930" style="zoom: 33%;" />

#### ⑥窗口

> [!IMPORTANT]
>
> <img src="../images/image-20250105210705548.png" alt="image-20250105210705548" style="zoom:33%;" />

> [!CAUTION]
>
> 注意：<img src="../images/image-20250105210803963.png" alt="image-20250105210803963" style="zoom:25%;" />
>
> - 这个字段是实现“<u>流量控制</u>”的关键
> - “<u>窗口</u>”在真题中常简记为==rwnd==或 ==rcvwnd==



**“窗口”rcvwnd示例**

<img src="../images/image-20250105210833773.png" alt="image-20250105210833773" style="zoom:33%;" />

#### ⑦检验和



<img src="../images/image-20250105210916562.png" alt="image-20250105210916562" style="zoom:33%;" />

**回顾&对比：UDP检验**

<img src="../images/image-20250105210940113.png" alt="image-20250105210940113" style="zoom:33%;" />

#### ⑧选项——包含MSS

> [!IMPORTANT]
>
> <img src="../images/image-20250105211127953.png" alt="image-20250105211127953" style="zoom:33%;" />
>
> - 建立TCP连接时，在<u>握手①</u>、<u>握手②</u>选项中协商<font color='red'>==MSS==（ Maximum Segment Size，最大段长）</font>
> - ==MSS的值表示在接下来的数据传输中，一个TCP报文段最多携带多少数据（首部不算在内）==
> - 通常MSS不会设置太大，以免在IP层被分片



<img src="../images/image-20250105211242391.png" alt="image-20250105211242391" style="zoom:33%;" />

## 五、TCP连接管理



### **知识总览**

<img src="../images/image-20250105213814106.png" alt="image-20250105213814106" style="zoom:50%;" />

<img src="../images/image-20250105211507301.png" alt="image-20250105211507301" style="zoom:33%;" />

### 1.回顾：TCP首部的常考字段

<img src="../images/image-20250105211530363.png" alt="image-20250105211530363" style="zoom: 50%;" />

**<font color='blue'>只有<u>*握手①*</u>的ACK=0，其他所有TCP报文段都是ACK=1</font>**

<font color='red'>**只有<u>*握手①、握手②*</u>的SYN=1，其他所有TCP报文段都是SYN=0**</font>

**<font color='green'>只有*<u>挥手①、挥手③</u>*的FIN=1，其他所有TCP报文段都是FIN=0</font>**

 

### 2.TCP连接管理高频命题角度



<img src="../images/image-20250105211749308.png" alt="image-20250105211749308" style="zoom:33%;" />

### 3.建立连接（三次握手）



#### ①

<img src="../images/image-20250105211809033.png" alt="image-20250105211809033" style="zoom: 50%;" />

**此图重点体会：**

三次握手的TCP报文段中，SYN、ACK、seq、ack



**考试要点：**

- 在TCP全过程中，只有握手①、握手②的SYN=1
- 在TCP全过程中，只有握手①的ACK=0
- 握手①、握手②不能携带数据（只有TCP首部），但是仍要消耗一个序号



**例题**   C

![image-20250105212035677](../images/image-20250105212035677.png)

#### ②

<img src="../images/image-20250105212110924.png" alt="image-20250105212110924" style="zoom:50%;" />

**此图重点体会：**

三次握手过程中，客户端、服务器进程<font color='red'>TCP状态是如何变化的?</font>



**考试要点：**

- 发出/收到 某个握手报文段前后，TCP状态如何变化？
- 记忆型考点，建议考前几天回顾（短时记忆）



**例题**

<img src="../images/image-20250105212215773.png" alt="image-20250105212215773" style="zoom:33%;" />

<font color='red'>注：本题考释放连接阶段的状态转换，同类题目也可能考建立连接阶段</font>



#### ③

<img src="../images/image-20250105212402434.png" alt="image-20250105212402434" style="zoom: 50%;" /><img src="../images/image-20250105212409780.png" alt="image-20250105212409780" style="zoom: 50%;" />



**此图重点体会：**

左右两个例子的区别



**考试要点：**

- 握手①②不能携带数据，握手③可以携带数据
- 握手①②固定消耗1个序号
- 握手③如果不携带数据就不消耗序号



### 4.建立连接阶段耗时分析



<img src="../images/image-20250105212528320.png" alt="image-20250105212528320" style="zoom:50%;" />

**考试要点：**

从发出握手①，到客户端进程可以发送数据，至少需要多久？——<font color='red'>1RTT</font>

从发出握手①，到服务器进程可以发送数据，至少需要多久？——<font color='red'>1.5RTT</font>

> 注：题目会给出RTT



### 5.释放连接（四次挥手）



#### ①

<img src="../images/image-20250105212632300.png" alt="image-20250105212632300" style="zoom:50%;" />

**此图重点体会：**

四次挥手的TCP报文段中，FIN、ACK、seq、ack



**考试要点：**

- 在TCP全过程中，只有挥手①、挥手③的FIN=1
- 挥手①、挥手③即使不携带数据，也要消耗一个序号
- 挥手②<u>可以</u>携带数据
- 挥手④<u>不可以</u>携带数据

#### ②

<img src="../images/image-20250105212725650.png" alt="image-20250105212725650" style="zoom:50%;" />

**此图重点体会：**

四次握手过程中，客户端、服务器进程<font color='red'>TCP状态是如何变化的？</font>



**考试要点：**

- 发出/收到 某个挥手报文段前后，TCP状态如何变化？
- 记忆型考点，建议考前几天回顾（短时记忆）

> [!CAUTION]
>
> 注意：也可以是服务器先发出挥手



**例题**     B

<img src="../images/image-20250105213257524.png" alt="image-20250105213257524" style="zoom:50%;" />

### 6.释放连接阶段耗时分析



<img src="../images/image-20250105213321934.png" alt="image-20250105213321934" style="zoom:50%;" />

> [!CAUTION]
>
> - 补充1：客户进程收到挥手③后，立即进入TIME-WAIT状态，并启动“TIME-WAIT计时器”，==倒计时2MSL后才能进入CLOSE状态==。（如果等待期间重复收到挥手③，就重置计时器
> - 补充2： <font color='red'>MSL</font>（Maximum Segment Lifetime，最长报文段寿命），是由TCP协议规定的一个固定时间长度



<img src="../images/image-20250105213423577.png" alt="image-20250105213423577" style="zoom:50%;" />

**考试要点：**

- 从客户发出挥手①，到客户进程进入CLOSE状态，至少需要多久？——<font color='red'>1RTT+2MSL</font>
- 从客户发出握手①，到服务器进程进程进入CLOSE状态，至少需要多久？——<font color='red'>1.5RTT</font>



> [!CAUTION]
>
> - 补充3：如果服务器进程收到挥手①时，已经没有待传送数据，那么可以连续发出挥手②、挥手③



**例题 **    D

<img src="../images/image-20250105213629932.png" alt="image-20250105213629932" style="zoom:50%;" />



## 六、TCP可靠传输&流量控制



### 知识总览



<img src="../images/image-20250106193829142.png" alt="image-20250106193829142" style="zoom:50%;" />

<img src="../images/image-20250106193840947.png" alt="image-20250106193840947" style="zoom: 50%;" />

<img src="../images/image-20250106193854245.png" alt="image-20250106193854245" style="zoom:50%;" />



### 1.回顾：TCP首部的相关字段



<img src="../images/image-20250106193932878.png" alt="image-20250106193932878" style="zoom: 33%;" />



### 2.一个端口可以建立多个TCP连接



<img src="../images/image-20250106194022416.png" alt="image-20250106194022416" style="zoom:200%;" />



### 3.TCP传输的底层原理



<img src="../images/image-20250106194057672.png" alt="image-20250106194057672" style="zoom:33%;" />

**重点体会：确认号、接收窗口大小**



<img src="../images/image-20250106194344239.png" alt="image-20250106194344239" style="zoom:33%;" /><img src="../images/image-20250106194358020.png" alt="image-20250106194358020" style="zoom:28%;" />

<img src="../images/image-20250106194436924.png" alt="image-20250106194436924" style="zoom:33%;" /><img src="../images/image-20250106194449201.png" alt="image-20250106194449201" style="zoom:33%;" />



**重点体会：累积确认**



<img src="../images/image-20250106194526211.png" alt="image-20250106194526211" style="zoom:28%;" /><img src="../images/image-20250106194539271.png" alt="image-20250106194539271" style="zoom:28%;" />

<img src="../images/image-20250106194613630.png" alt="image-20250106194613630" style="zoom:33%;" />



**重点体会：捎带确认**



<img src="../images/image-20250106194642810.png" alt="image-20250106194642810" style="zoom:33%;" /><img src="../images/image-20250106194652213.png" alt="image-20250106194652213" style="zoom:28%;" />

<img src="../images/image-20250106194711623.png" alt="image-20250106194711623" style="zoom:33%;" />

<img src="../images/image-20250106194722973.png" alt="image-20250106194722973" style="zoom:33%;" />

**重点体会：超时重传机制**



<img src="../images/image-20250106194740628.png" alt="image-20250106194740628" style="zoom: 30%;" /><img src="../images/image-20250106194757964.png" alt="image-20250106194757964" style="zoom:28%;" />

<img src="../images/image-20250106194829862.png" alt="image-20250106194829862" style="zoom:33%;" />

<img src="../images/image-20250106194842766.png" alt="image-20250106194842766" style="zoom:33%;" /><img src="../images/image-20250106194852903.png" alt="image-20250106194852903" style="zoom:30%;" />



<img src="../images/image-20250106194933992.png" alt="image-20250106194933992" style="zoom:33%;" />

**重点体会：快重传机制、立即确认机制**





![image-20250106194958786](../images/image-20250106194958786.png)

<img src="../images/image-20250106195952854.png" alt="image-20250106195952854" style="zoom:50%;" />

<img src="../images/image-20250106200005578.png" alt="image-20250106200005578" style="zoom: 33%;" />

<img src="../images/image-20250106200025907.png" alt="image-20250106200025907" style="zoom:33%;" />

<img src="../images/image-20250106193840947.png" alt="image-20250106193840947" style="zoom: 50%;" />





## 七、TCP拥塞控制



### 1.拥塞控制的四种算法



<img src="../images/image-20250106224726317.png" alt="image-20250106224726317" style="zoom:50%;" />

### 2.TCP拥塞控制、TCP流量控制的区别与联系



![image-20250106224758076](../images/image-20250106224758076.png)



流量控制：控制端到端的数据发送量，是“<u>局部的</u>”

<font color='red'>拥塞控制</font>：控制<u>整个网络</u>中每台主机的数据发送量，降低路由器负载，是“<u>全局的</u>”



<font color='red'>如何判断网络拥塞？</font>

- 发出的每个报文段，都能顺利地收到ACK确认——不拥塞
- 发出的报文段未能按时收到ACK，引发超时重传——严重拥塞
- 收到冗余ACK，引发快重传——有点拥塞



<font color='red'>如果检测到网络拥塞怎么办？</font>

- 迅速减少发送的数据量
- 严重拥塞就迅速缩小拥塞窗口
- 有点拥塞就适当缩小拥塞窗口



### 3.拥塞控制考题特点



<img src="../images/image-20250106224954479.png" alt="image-20250106224954479" style="zoom:50%;" />

拥塞控制考题特点：
1. 常与“流量控制”综合考察，此时需要考虑接收窗口大小
2. 通常只涉及单向传输（TCP连接双方只有一方发送数据）
3. <font color='red'>通常默认每个TCP报文段都以最大段长MSS满载数据</font>
4. <font color='red'>拥塞窗口的大小常以“MSS的倍数”作为单位</font>
5. 接收方收到一个报文段，会“<font color='blue'>立即确认</font>”，而不是“推迟确认”

> 立即确认会导致冗余ACK，快重传



注：为了聚焦拥塞控制，接下来的讨论中，假设接收方的接收窗口足够大，这样发送窗口大小就只受拥塞窗口限制



### 4.慢开始、拥塞避免



<img src="../images/image-20250106225109185.png" alt="image-20250106225109185" style="zoom:50%;" />

**慢开始算法**：cwnd 值从1开始，<font color='red'>每收到⼀个ACK，就让 cwnd+1</font>（**当 cwnd<ssthress 时适用**）

**拥塞避免算法**：在⼀个RTT内，<font color='red'>即使收到多个ACK，也只能让 cwnd+1</font>（**当 cwnd≥ssthress 时适用**）



<img src="../../../Documents/Tencent Files/2251198467/nt_qq/nt_data/Pic/2025-01/Ori/392d7665bc2ea2fa54bd00831c91ba55.png" alt="392d7665bc2ea2fa54bd00831c91ba55" style="zoom:50%;" />

C↓

<img src="../images/image-20250106225352238.png" alt="image-20250106225352238" style="zoom:50%;" />

<img src="../images/image-20250106225402929.png" alt="image-20250106225402929" style="zoom:50%;" />

<img src="../images/image-20250107100720511.png" alt="image-20250107100720511" style="zoom:33%;" />



### 5.快重传和快恢复



<img src="../images/image-20250106225433518.png" alt="image-20250106225433518" style="zoom:50%;" />

**快重传**：当发送方收到三个确认号相同的冗余ACK时，立即重传对应报文段

**快恢复算法**：⼀旦<font color='red'>发生快重传</font>，就将<font color='red'>阈值、cwnd 都设为当前 cwnd 的⼀半</font>，然后<font color='red'>切换到为“拥塞避免算法”</font>

<img src="../images/image-20250106225538938.png" alt="image-20250106225538938" style="zoom:50%;" />



# 第六章 应用层



**大纲**



<img src="../images/image-20250107103717243.png" alt="image-20250107103717243" style="zoom:33%;" />



**各种协议之间的服务关系**



<img src="../images/image-20250107103742256.png" alt="image-20250107103742256" style="zoom: 50%;" />

**DNS**：将域名(网址)转换为IP地址

**FTP**：用于文件传输

**HTTP**：常用于浏览网页

**SMTP、POP3**：用于电子邮件(Email)



## 一、网络应用模型



<img src="../images/image-20250107104009500.png" alt="image-20250107104009500" style="zoom:50%;" />



### 1.客户/服务器模型





**客户/服务器模型实例：百度网盘**



<img src="../images/image-20250107104405191.png" alt="image-20250107104405191" style="zoom:50%;" />

注：“服务器”本质上也是一台主机（可理解为性能强悍的电脑）

体会**C/S模型特点**：

- 客户、服务器地位不平等
- 客户之间不直接通信
- 如果服务器损坏，影响全局
- 服务器负载较大



### 2.P2P模型



<img src="../images/image-20250107104031278.png" alt="image-20250107104031278" style="zoom:33%;" />

- 不存在永远在线的服务器
- 每个主机既可以提供服务，也可以请求服务
- 任意端系统/节点之间可以直接通讯
- 节点间歇性接入网络
- 节点可能改变IP地址
- 可拓展性好
- 网络健壮性强



**P2P模型实例：BT种子下载**



<img src="../images/image-20250107104520038.png" alt="image-20250107104520038" style="zoom:50%;" />

体会**P2P模型特点**：

- 主机之间地位平等
- 主机之间直接通信
- 单个节点损坏不影响全局
- 各节点可以分摊负载



## 二、域名系统DNS



### 1.DNS系统

> 联机分布式数据库系统

<img src="../images/image-20250107104729807.png" alt="image-20250107104729807" style="zoom: 50%;" />

<img src="../images/image-20250107105016339.png" alt="image-20250107105016339" style="zoom: 33%;" />

DNS服务的作用：将域名解析成IP地址



### 2.域名



<img src="../images/image-20250107104750908.png" alt="image-20250107104750908" style="zoom:50%;" />

> 三级域名指向特定的服务器或子网
>
> 四级域名代表在三级域名基础上进一步划分的子域名



<img src="../images/image-20250107105031415.png" alt="image-20250107105031415" style="zoom:50%;" />



### 3.域名服务器



<img src="../images/image-20250107104905537.png" alt="image-20250107104905537" style="zoom:50%;" />

<img src="../images/image-20250107104923396.png" alt="image-20250107104923396" style="zoom:50%;" />

<img src="../images/image-20250107105219978.png" alt="image-20250107105219978" style="zoom: 33%;" />

<img src="../images/image-20250107105232580.png" alt="image-20250107105232580" style="zoom: 33%;" />

**域名服务器原理类比**

<img src="../images/image-20250107105301975.png" alt="image-20250107105301975" style="zoom: 33%;" />

<img src="../images/image-20250107105325110.png" alt="image-20250107105325110" style="zoom:33%;" />

<img src="../images/image-20250107105337984.png" alt="image-20250107105337984" style="zoom:33%;" />

<img src="../images/image-20250107105348849.png" alt="image-20250107105348849" style="zoom:33%;" />



### 4.域名解析过程



<img src="../images/image-20250107105147349.png" alt="image-20250107105147349" style="zoom:50%;" />

<img src="../images/image-20250107105157428.png" alt="image-20250107105157428" style="zoom:50%;" />

**域名解析过程类比（递归查询）**



<img src="../images/image-20250107105405621.png" alt="image-20250107105405621" style="zoom:33%;" />

<img src="../images/image-20250107105428622.png" alt="image-20250107105428622" style="zoom: 33%;" />

**域名解析过程类比（迭代查询）**



<img src="../images/image-20250107105448187.png" alt="image-20250107105448187" style="zoom: 33%;" />

<img src="../images/image-20250107105500410.png" alt="image-20250107105500410" style="zoom:33%;" />

**<font color='red'>域名解析过程（递归查询）</font>**



<img src="../images/image-20250107105531034.png" alt="image-20250107105531034" style="zoom:33%;" />

**<font color='red'>域名解析过程（迭代查询）</font>**



<img src="../images/image-20250107105619629.png" alt="image-20250107105619629" style="zoom:33%;" />



## 三、文件传输协议FTP



### 1.文件传送协议

<img src="../images/image-20250107105721685.png" alt="image-20250107105721685" style="zoom:33%;" />



### 2.FTP服务器和用户端



<img src="../images/image-20250107105746602.png" alt="image-20250107105746602" style="zoom:50%;" />



### 3.FTP工作原理



<img src="../images/image-20250107105811944.png" alt="image-20250107105811944" style="zoom:50%;" />

<img src="../images/image-20250107105824490.png" alt="image-20250107105824490" style="zoom:50%;" />

<img src="../images/image-20250107105841179.png" alt="image-20250107105841179" style="zoom:50%;" />

## 四、电子邮件



### 1.电子邮件系统概述



<img src="../images/image-20250107105931267.png" alt="image-20250107105931267" style="zoom:33%;" />

#### ①电子邮件的信息格式



<img src="../images/image-20250107110002709.png" alt="image-20250107110002709" style="zoom:50%;" />

#### ②组成结构



<img src="../images/image-20250107110027774.png" alt="image-20250107110027774" style="zoom:50%;" />

<img src="../images/image-20250107110037592.png" alt="image-20250107110037592" style="zoom:50%;" />

### 2.简单邮件传送协议SMTP



<img src="../images/image-20250107110108151.png" alt="image-20250107110108151" style="zoom:50%;" />

<img src="../images/image-20250107110119028.png" alt="image-20250107110119028" style="zoom:50%;" />



### 3.MIME



SMTP的缺点：

<img src="../images/image-20250107110140014.png" alt="image-20250107110140014" style="zoom:50%;" />

### 4.邮局协议POP3



<img src="../images/image-20250107110218934.png" alt="image-20250107110218934" style="zoom:50%;" />

### 5.网际报文存取协议IMAP



<img src="../images/image-20250107110246955.png" alt="image-20250107110246955" style="zoom:50%;" />



### 6.基于万维网的电子邮件



<img src="../images/image-20250107110310171.png" alt="image-20250107110310171" style="zoom:50%;" />



## 五、万维网



### 知识总览



<img src="../images/image-20250107111327283.png" alt="image-20250107111327283" style="zoom: 50%;" />



### 1.体会：一个网页的构成



<img src="../images/image-20250107110348503.png" alt="image-20250107110348503" style="zoom:50%;" />

网页= <font color='red'>1个</font><u>html文件</u> + <font color='red'>n个</font><u>网页元素</u>（如图片、视频等文件）

> html 文件中会说明要引用哪些元素（指明存储路径）

<img src="../images/image-20250107110453784.png" alt="image-20250107110453784" style="zoom: 33%;" />



### 2.观察：html文件的内容（用记事本打开）



<img src="../images/image-20250107110524544.png" alt="image-20250107110524544" style="zoom:33%;" />



### 3.当你访问了一个网站的时候，背后发生了什么



<img src="../images/image-20250107110607197.png" alt="image-20250107110607197" style="zoom:50%;" />

**浏览器访问⼀个网页的过程（非常重要）：**

1. 用户输入网址（域名）
2. 浏览器通过DNS服务器查询域名对应的IP地址（浏览器会将查询结果“域名→IP”缓存在本地）
3. 浏览器与<Web服务器IP地址:80端口建立TCP连接
4. 浏览器在握手③中携带HTTP请求报文（指明要访问哪个html网页）
5. 服务器返回HTTP响应报文（携带html文件）
6. 如果html引用了其他<font color='blue'>n个元素</font>，还需要<font color='blue'>n组</font>HTTP请求&响应（<font color='red'>持续、非持续</font>工作方式有所区别）

<img src="../images/image-20250107110748435.png" alt="image-20250107110748435" style="zoom:50%;" />





### 4.HTTP协议的工作方式



<img src="../images/image-20250107110849630.png" alt="image-20250107110849630" style="zoom:50%;" />

<img src="../images/image-20250107110910552.png" alt="image-20250107110910552" style="zoom:50%;" />

#### ①非持续连接



<img src="../../../AppData/Local/Temp/917c9b22-a9d7-44c4-a469-b5ee89d55f56.png" alt="917c9b22-a9d7-44c4-a469-b5ee89d55f56" style="zoom:50%;" />

#### ②持续连接——非流水线



<img src="../images/image-20250107111208312.png" alt="image-20250107111208312" style="zoom:50%;" />

#### ③持续连接——流水线



<img src="../images/image-20250107111231090.png" alt="image-20250107111231090" style="zoom:50%;" />



## 六、超文本传输协议（HTTP）



> 超文本的含义是该文本中含有链接到其他文本的链接点

### 知识总览



<img src="../images/image-20250107111437687.png" alt="image-20250107111437687" style="zoom:50%;" />



### 1.HTTP报文格式



<img src="../images/image-20250107111503007.png" alt="image-20250107111503007" style="zoom:50%;" />



### 2.HTTP报文格式实例



<img src="../images/image-20250107111524165.png" alt="image-20250107111524165" style="zoom:50%;" />

### 3.Cookie的作用



<img src="../images/image-20250107111543505.png" alt="image-20250107111543505" style="zoom:50%;" />

**例题**



<img src="../images/image-20250107111601559.png" alt="image-20250107111601559" style="zoom:50%;" />
